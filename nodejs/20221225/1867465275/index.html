<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png">
  <link rel="mask-icon" href="/images/favicon.png" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha256-CTSx/A06dm1B063156EVh15m6Y67pAjZZaQc89LLSrU=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.24/fancybox/fancybox.css" integrity="sha256-vQkngPS8jiHHH0I6ABTZroZk8NPZ7b+MUReOFE9UsXQ=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"israynotarray.com","root":"/","images":"/images","scheme":"Pisces","darkmode":true,"version":"8.18.2","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":"mac"},"fold":{"enable":false,"height":800},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":false,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜尋...","empty":"我們無法找到任何有關 ${query} 的搜索結果","hits_time":"${hits} 找到 ${time} 個結果","hits":"找到 ${hits} 個結果"},"algolia":{"appID":"MU7N4K4R36","apiKey":"110ed15d0a4842310bafc6fdfda119c4","indexName":"blog","hits":{"per_page":10}}}</script><script src="/js/config.js"></script>

    <meta name="description" content="之前有分享過「超完整 Express Imgur 套件上傳教學」，所以這一篇就改來介紹 Firebase Storage 的上傳教學，而這一篇會盡可能流程步驟都說明清楚，因為這一塊也是稍微有一點複雜。">
<meta property="og:type" content="article">
<meta property="og:title" content="一步一步帶你用 Node.js 上傳檔案到 Firebase Storage">
<meta property="og:url" content="https://israynotarray.com/nodejs/20221225/1867465275/index.html">
<meta property="og:site_name" content="是 Ray 不是 Array">
<meta property="og:description" content="之前有分享過「超完整 Express Imgur 套件上傳教學」，所以這一篇就改來介紹 Firebase Storage 的上傳教學，而這一篇會盡可能流程步驟都說明清楚，因為這一塊也是稍微有一點複雜。">
<meta property="og:locale" content="zh_TW">
<meta property="og:image" content="https://i.imgur.com/mJkWN51.png">
<meta property="og:image" content="https://firebasestorage.googleapis.com/v0/b/welcomewebworld-4097b.appspot.com/o/blogImg%2Ffirebase%2Ffirebase-express%2F%E6%88%AA%E5%9C%96%202022-12-23%2022.34.31.png?alt=media&token=e4b53259-8a28-4062-a4c8-db33056e052d">
<meta property="og:image" content="https://firebasestorage.googleapis.com/v0/b/welcomewebworld-4097b.appspot.com/o/blogImg%2Ffirebase%2Ffirebase-express%2F202212232237.jpg?alt=media&token=46e28e0c-f00d-40c4-a747-c7d56bd182fd">
<meta property="og:image" content="https://firebasestorage.googleapis.com/v0/b/welcomewebworld-4097b.appspot.com/o/blogImg%2Ffirebase%2Ffirebase-express%2F%E6%88%AA%E5%9C%96%202022-12-23%2022.44.13.png?alt=media&token=8f380d4c-20ab-4f82-972b-923d5d29f96c">
<meta property="og:image" content="https://firebasestorage.googleapis.com/v0/b/welcomewebworld-4097b.appspot.com/o/blogImg%2Ffirebase%2Ffirebase-express%2F%E6%88%AA%E5%9C%96%202022-12-23%2022.48.20.png?alt=media&token=d8e5f50d-0a39-411a-8987-e97f121b07b4">
<meta property="og:image" content="https://firebasestorage.googleapis.com/v0/b/welcomewebworld-4097b.appspot.com/o/blogImg%2Ffirebase%2Ffirebase-express%2F%E6%88%AA%E5%9C%96%202022-12-23%2022.49.19.png?alt=media&token=6d613fff-ebd2-4fd4-9f5e-74bb0180b8e5">
<meta property="og:image" content="https://firebasestorage.googleapis.com/v0/b/welcomewebworld-4097b.appspot.com/o/blogImg%2Ffirebase%2Ffirebase-express%2F%E6%88%AA%E5%9C%96%202022-12-23%2022.49.55.png?alt=media&token=5f3f97a1-6cbe-44d0-856a-599c1c562da5">
<meta property="og:image" content="https://firebasestorage.googleapis.com/v0/b/welcomewebworld-4097b.appspot.com/o/blogImg%2Ffirebase%2Ffirebase-express%2F%E6%88%AA%E5%9C%96%202022-12-23%2022.50.39.png?alt=media&token=b2e18403-c7ea-4a9a-a6b3-00796973187f">
<meta property="og:image" content="https://firebasestorage.googleapis.com/v0/b/welcomewebworld-4097b.appspot.com/o/blogImg%2Ffirebase%2Ffirebase-express%2F%E6%88%AA%E5%9C%96%202022-12-24%2012.46.32.png?alt=media&token=7c240880-dd87-4074-87dc-3e5295199a65">
<meta property="og:image" content="https://firebasestorage.googleapis.com/v0/b/welcomewebworld-4097b.appspot.com/o/blogImg%2Ffirebase%2Ffirebase-express%2F%E6%88%AA%E5%9C%96%202022-12-24%2013.37.04.png?alt=media&token=20e7bafc-0973-42bb-bde2-258fa1b7ade8">
<meta property="og:image" content="https://firebasestorage.googleapis.com/v0/b/welcomewebworld-4097b.appspot.com/o/blogImg%2Ffirebase%2Ffirebase-express%2F%E6%88%AA%E5%9C%96%202022-12-24%2014.57.00.png?alt=media&token=da01d5cf-ce40-4800-ae69-b650f25513f8">
<meta property="og:image" content="https://firebasestorage.googleapis.com/v0/b/welcomewebworld-4097b.appspot.com/o/blogImg%2Ffirebase%2Ffirebase-express%2F%E6%88%AA%E5%9C%96%202022-12-24%2015.01.36.png?alt=media&token=bc70790f-f0c8-4dc7-863e-ec39b23fa4c5">
<meta property="og:image" content="https://firebasestorage.googleapis.com/v0/b/welcomewebworld-4097b.appspot.com/o/blogImg%2Ffirebase%2Ffirebase-express%2F%E6%88%AA%E5%9C%96%202022-12-24%2015.03.30.png?alt=media&token=047613d6-31a1-4c37-8b44-48e314cc0366">
<meta property="og:image" content="https://firebasestorage.googleapis.com/v0/b/welcomewebworld-4097b.appspot.com/o/blogImg%2Ffirebase%2Ffirebase-express%2F%E6%88%AA%E5%9C%96%202022-12-24%2015.04.01.png?alt=media&token=b7ab7541-81f8-4551-a940-bcb67c2b78bc">
<meta property="og:image" content="https://firebasestorage.googleapis.com/v0/b/welcomewebworld-4097b.appspot.com/o/blogImg%2Ffirebase%2Ffirebase-express%2F%E6%88%AA%E5%9C%96%202022-12-23%2023.05.46.png?alt=media&token=7ad005bc-2a5a-4958-9c36-e09ee40b888c">
<meta property="og:image" content="https://firebasestorage.googleapis.com/v0/b/welcomewebworld-4097b.appspot.com/o/blogImg%2Ffirebase%2Ffirebase-express%2F%E6%88%AA%E5%9C%96%202022-12-23%2023.29.37.png?alt=media&token=1a9b6822-90c2-41ad-8601-47df2e5e6dbf">
<meta property="og:image" content="https://firebasestorage.googleapis.com/v0/b/welcomewebworld-4097b.appspot.com/o/blogImg%2Ffirebase%2Ffirebase-express%2F%E6%88%AA%E5%9C%96%202022-12-24%2017.05.53.png?alt=media&token=446ba542-3307-47dd-8fa6-eff16a843ae8">
<meta property="og:image" content="https://firebasestorage.googleapis.com/v0/b/welcomewebworld-4097b.appspot.com/o/blogImg%2Ffirebase%2Ffirebase-express%2F%E6%88%AA%E5%9C%96%202022-12-25%2000.07.31.png?alt=media&token=cedd4800-9208-4907-a51c-b6460e1dc69e">
<meta property="og:image" content="https://firebasestorage.googleapis.com/v0/b/welcomewebworld-4097b.appspot.com/o/blogImg%2Ffirebase%2Ffirebase-express%2F%E6%88%AA%E5%9C%96%202022-12-25%2000.29.57.png?alt=media&token=4300e2cb-b2fb-49b2-89c7-e67556e4013b">
<meta property="og:image" content="https://firebasestorage.googleapis.com/v0/b/welcomewebworld-4097b.appspot.com/o/blogImg%2Ffirebase%2Ffirebase-express%2F%E6%88%AA%E5%9C%96%202022-12-25%2014.41.00.png?alt=media&token=a24719fb-b21a-44cc-bfda-2b1166117fd0">
<meta property="og:image" content="https://firebasestorage.googleapis.com/v0/b/welcomewebworld-4097b.appspot.com/o/blogImg%2Ffirebase%2Ffirebase-express%2F%E6%88%AA%E5%9C%96%202022-12-25%2014.03.34.png?alt=media&token=607923fa-53e1-4267-a475-6510cfcca4c8">
<meta property="og:image" content="https://firebasestorage.googleapis.com/v0/b/welcomewebworld-4097b.appspot.com/o/blogImg%2Ffirebase%2Ffirebase-express%2F%E6%88%AA%E5%9C%96%202022-12-25%2016.09.33.png?alt=media&token=19f91bdb-137a-4a34-9736-c7c2bab941a3">
<meta property="og:image" content="https://firebasestorage.googleapis.com/v0/b/welcomewebworld-4097b.appspot.com/o/blogImg%2Ffirebase%2Ffirebase-express%2F%E6%88%AA%E5%9C%96%202022-12-25%2016.11.51.png?alt=media&token=c60bbd76-c8af-4a03-b042-d3e95743863c">
<meta property="og:image" content="https://firebasestorage.googleapis.com/v0/b/welcomewebworld-4097b.appspot.com/o/blogImg%2Ffirebase%2Ffirebase-express%2F202212251613.jpg?alt=media&token=83fe1598-75f4-4828-adec-98c35eec236e">
<meta property="og:image" content="https://firebasestorage.googleapis.com/v0/b/welcomewebworld-4097b.appspot.com/o/blogImg%2Ffirebase%2Ffirebase-express%2F%E6%88%AA%E5%9C%96%202022-12-25%2016.23.12.png?alt=media&token=68f84506-dadb-4f57-bad7-f9fa4d31f837">
<meta property="article:published_time" content="2022-12-25T09:00:00.000Z">
<meta property="article:modified_time" content="2023-02-13T07:30:00.000Z">
<meta property="article:author" content="Ray">
<meta property="article:tag" content="Node.js">
<meta property="article:tag" content="Firebase">
<meta property="article:tag" content="Express">
<meta property="article:tag" content="Imgur">
<meta property="article:tag" content="Firebase Storage">
<meta property="article:tag" content="Storage">
<meta property="article:tag" content="multer">
<meta property="article:tag" content="TinyPNG">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.imgur.com/mJkWN51.png">


<link rel="canonical" href="https://israynotarray.com/nodejs/20221225/1867465275/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-TW","comments":true,"permalink":"https://israynotarray.com/nodejs/20221225/1867465275/","path":"nodejs/20221225/1867465275/","title":"一步一步帶你用 Node.js 上傳檔案到 Firebase Storage"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>一步一步帶你用 Node.js 上傳檔案到 Firebase Storage | 是 Ray 不是 Array</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-FC8R6QFRC3"></script>
  <script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"G-FC8R6QFRC3","only_pageview":false}</script>
  <script src="/js/third-party/analytics/google-analytics.js"></script>




  <script type="text/javascript">
    (function(c,l,a,r,i,t,y){
        c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
        t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
        y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
    })(window, document, "clarity", "script", "h46z900dov");
</script>



<style>
  .message-block {
    color: black;
    display: none;
    justify-content: center;
    align-items: center;
    height: 100%;
  }
</style>
<script async="async" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
  window.onload = () => {
    setTimeout(() => {
      const ads = document.querySelector('ins.adsbygoogle');
      if(!ads.getAttribute('data-adsbygoogle-status')) {
        console.clear();
        console.log(`
        ██████╗██╗  ██╗    ███╗   ██╗██████╗     ██╗
        ██╔═══████║  ██║    ████╗  ████╔═══██╗    ██║
        ██║   █████████║    ██╔██╗ ████║   ██║    ██║
        ██║   ████╔══██║    ██║╚██╗████║   ██║    ╚═╝
        ╚██████╔██║  ██║    ██║ ╚████╚██████╔╝    ██╗
        ╚═════╝╚═╝  ╚═╝    ╚═╝  ╚═══╝╚═════╝     ╚═╝
        `);
        console.warn('RRRRヽ(*・ω・)ﾉ 廣告被阻擋了');
        console.warn('你都能發現這個彩蛋了，求你關閉 Adblock (廣告阻擋器) 支持我 ┭┮﹏┭┮')
        document.querySelector('.message-block').style.display = 'flex';
      } else {
        console.clear();
        console.info('你發現了這個毫無意義的彩蛋！但是我非常感謝你關閉 Adblock (廣告阻擋器) ㄟ(≧◇≦)ㄏ');
        console.info('因為你關閉 Adblock 也代表你支持我 (((o(*ﾟ▽ﾟ*)o)))')
        console.info('底下我也給你佛祖保佑的圖片，祝你開發順利 (๑•̀ㅂ•́)و✧')
        console.info(`
                             _oo0oo_
                            o8888888o
                            88" . "88
                            (| -_- |)
                            0\  =  /0
                          ___/'---'\___
                        .' \||     ||/ '.
                        / \||||  :  ||||/ |
                      | _||||| -:- |||||- |
                      |   | \|\  -  /|/ |   |
                      | \_|  ''\---/''  |_/ |
                      |  .-\__  '-'  ___/-. |
                    ___'. .'  /--.--\  '. .'___
                ."" '<  '.___\_<|>_/___.' >' "".
                | | :  '- \'.;'\ _ /';.'/ - ' : | |
                |  | '_.   \_ __\ /__ _/   .-' |  |
            ====='-.____'.___ \_____/___.-'___.-'=====
                              '=---='
            ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
      
                          佛祖保佑，永無 BUG
                          薪水增多，財富自由
        `)
      }

      function unregister() {
          if ('serviceWorker' in navigator) {
              navigator.serviceWorker.getRegistrations().then(function(registrations) {
                  for (let registration of registrations) {
                      registration.unregister();
                  }
              });
          }
      }

      unregister();
    }, 5000)
    
  }
</script>
  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="是 Ray 不是 Array" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切換導航欄" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">是 Ray 不是 Array</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Welcome.Web.World <br/> 歡迎來到網路世界</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜尋" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首頁</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>標籤</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分類</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>歸檔</a></li><li class="menu-item menu-item-rss"><a href="/atom.xml" rel="section"><i class="fa fa-rss fa-fw"></i>RSS</a></li><li class="menu-item menu-item-更多"><a href="/links/" rel="section"><i class="fa fa-link fa-fw"></i>更多</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜尋
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container"></div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container">
  <div class="algolia-stats"><hr></div>
  <div class="algolia-hits"></div>
  <div class="algolia-pagination"></div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目錄
        </li>
        <li class="sidebar-nav-overview">
          本站概要
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Firebase-%E4%BA%8B%E5%89%8D%E6%BA%96%E5%82%99"><span class="nav-number">2.</span> <span class="nav-text">Firebase 事前準備</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BB%BA%E7%AB%8B-Firebase-%E5%B0%88%E6%A1%88"><span class="nav-number">2.1.</span> <span class="nav-text">建立 Firebase 專案</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A8%AD%E5%AE%9A-Firebase-Storage"><span class="nav-number">2.2.</span> <span class="nav-text">設定 Firebase Storage</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%96%E5%BE%97-Firebase-Admin-SDK"><span class="nav-number">2.3.</span> <span class="nav-text">取得 Firebase Admin SDK</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Express-Firebase"><span class="nav-number">3.</span> <span class="nav-text">Express + Firebase</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BB%BA%E7%AB%8B-Express-%E5%B0%88%E6%A1%88"><span class="nav-number">3.1.</span> <span class="nav-text">建立 Express 專案</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BB%BA%E7%AB%8B-upload-%E8%B3%87%E6%96%99%E5%A4%BE"><span class="nav-number">3.2.</span> <span class="nav-text">建立 upload 資料夾</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%9D%E7%9B%B8%E9%97%9C%E5%A5%97%E4%BB%B6"><span class="nav-number">3.3.</span> <span class="nav-text">安裝相關套件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BB%BA%E7%AB%8B-env-%E6%AA%94%E6%A1%88"><span class="nav-number">3.4.</span> <span class="nav-text">建立 .env 檔案</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AF%A6%E4%BD%9C%E4%B8%8A%E5%82%B3%E5%8A%9F%E8%83%BD"><span class="nav-number">4.</span> <span class="nav-text">實作上傳功能</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%8A%E5%82%B3%E6%AA%94%E6%A1%88"><span class="nav-number">4.1.</span> <span class="nav-text">上傳檔案</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%96%E5%BE%97%E6%AA%94%E6%A1%88%E7%B6%B2%E5%9D%80"><span class="nav-number">4.2.</span> <span class="nav-text">取得檔案網址</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%AA%E9%99%A4%E6%AA%94%E6%A1%88"><span class="nav-number">4.3.</span> <span class="nav-text">刪除檔案</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%96%E5%BE%97%E6%AA%94%E6%A1%88%E5%90%8D%E7%A8%B1%E5%88%97%E8%A1%A8"><span class="nav-number">4.4.</span> <span class="nav-text">取得檔案名稱列表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8C%87%E5%AE%9A%E4%B8%8A%E5%82%B3%E6%AA%94%E6%A1%88%E5%88%B0%E7%89%B9%E5%AE%9A%E8%B3%87%E6%96%99%E5%A4%BE"><span class="nav-number">4.5.</span> <span class="nav-text">指定上傳檔案到特定資料夾</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%AD%E9%80%94%E5%B0%8F%E7%B5%90"><span class="nav-number">5.</span> <span class="nav-text">中途小結</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8A%A0%E7%A2%BC%E8%A3%9C%E5%85%85"><span class="nav-number">6.</span> <span class="nav-text">加碼補充</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%87%8D%E6%96%B0%E5%91%BD%E5%90%8D%E6%AA%94%E6%A1%88"><span class="nav-number">6.1.</span> <span class="nav-text">重新命名檔案</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A3%93%E7%B8%AE%E5%9C%96%E7%89%87-TinyPNG"><span class="nav-number">6.2.</span> <span class="nav-text">壓縮圖片(TinyPNG)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%B5%90%E8%AB%96"><span class="nav-number">7.</span> <span class="nav-text">結論</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%83%E8%80%83%E6%96%87%E7%8D%BB"><span class="nav-number">8.</span> <span class="nav-text">參考文獻</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Ray"
      src="/images/octocat.jpg">
  <p class="site-author-name" itemprop="name">Ray</p>
  <div class="site-description" itemprop="description">👨‍💻F2E-Front End Engineer <br/> 歡迎來到網頁世界</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">975</span>
          <span class="site-state-item-name">文章</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">36</span>
        <span class="site-state-item-name">分類</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">830</span>
        <span class="site-state-item-name">標籤</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://www.buymeacoffee.com/israynotarray" title="BuyCoffee → https:&#x2F;&#x2F;www.buymeacoffee.com&#x2F;israynotarray" rel="noopener me" target="_blank"><i class="fa-solid fa-money-bill fa-fw"></i>BuyCoffee</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://portaly.cc/israynotarray" title="Portaly → https:&#x2F;&#x2F;portaly.cc&#x2F;israynotarray" rel="noopener me" target="_blank"><i class="fas fa-link fa-fw"></i>Portaly</a>
      </span>
  </div>
<div style="color: var(--text-color); width: 100%;">
  

<div style="color: var(--text-color); width: 100%;">
  <div>
    <h4>
      <i class="fab fa-google"></i>
      Google AD
    </h4>
  </div>
  <div
    style="height: 300px; border: 5px var(--text-color) dashed;">
    <div class="message-block">
      <p style="color: var(--text-color); font-size: 0.75rem;margin: 0;">
        撰寫一篇文章其實真的很花時間，如果你願意<strong>「關閉 Adblock (廣告阻擋器)」</strong>來支持我的話，我會非常感謝你 ヽ(・∀・)ﾉ
      </p>
    </div>
    <!-- hsiangfeng_slider -->
    <ins class="adsbygoogle"
        style="display:block"
        data-ad-client="ca-pub-4319471747130190"
        data-ad-slot="8042789820"
        data-ad-format="auto"
        data-full-width-responsive="true"></ins>
    <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
  </div>
</div>
        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-TW">
    <link itemprop="mainEntityOfPage" href="https://israynotarray.com/nodejs/20221225/1867465275/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/octocat.jpg">
      <meta itemprop="name" content="Ray">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="是 Ray 不是 Array">
      <meta itemprop="description" content="👨‍💻F2E-Front End Engineer <br/> 歡迎來到網頁世界">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="一步一步帶你用 Node.js 上傳檔案到 Firebase Storage | 是 Ray 不是 Array">
      <meta itemprop="description" content="之前有分享過「超完整 Express Imgur 套件上傳教學」，所以這一篇就改來介紹 Firebase Storage 的上傳教學，而這一篇會盡可能流程步驟都說明清楚，因為這一塊也是稍微有一點複雜。">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          一步一步帶你用 Node.js 上傳檔案到 Firebase Storage
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">發表於</span>

      <time title="創建時間：2022-12-25 17:00:00" itemprop="dateCreated datePublished" datetime="2022-12-25T17:00:00+08:00">2022-12-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新於</span>
      <time title="修改時間：2023-02-13 15:30:00" itemprop="dateModified" datetime="2023-02-13T15:30:00+08:00">2023-02-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分類於</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/nodejs/" itemprop="url" rel="index"><span itemprop="name">Nodejs</span></a>
        </span>
    </span>

  

<div style="color: var(--text-color); width: 100%;">
  <div>
    <h4>
      <i class="fab fa-google"></i>
      Google AD
    </h4>
  </div>
  <div
    style="height: 90px; width: 100%; border: 5px var(--text-color) dashed;">
    <div class="message-block">
      <p style="color: var(--text-color); font-size: 0.75rem;margin: 0;">
        撰寫一篇文章其實真的很花時間，如果你願意<strong>「關閉 Adblock (廣告阻擋器)」</strong>來支持我的話，我會非常感謝你 ヽ(・∀・)ﾉ
      </p>
    </div>
    <!-- hsiangfeng_postheader -->
    <ins
      class="adsbygoogle"
      style="display:block; height: 90px; width: 100%;font-size: 1rem;"
      data-ad-client="ca-pub-4319471747130190"
      data-ad-slot="2208469553"
      data-ad-format="auto"
      data-full-width-responsive="true">
    </ins>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
  </div>
</div>
<div style="color: var(--text-color); width: 100%;">
  <h4>
    <i class="fas fa-heart"></i>
    請我喝一杯咖啡
  </h4>
  <div style="border: 5px var(--text-color) dashed;padding: 20px;font-size: 14px;">
    這篇筆記文章如果對你有幫助，
    <br />
    你可以也可以請我「喝一杯咖啡(Donate)」。
    <br /><br />
    <div style="display: flex;justify-content: center;align-items: center;">
      <a href="https://www.buymeacoffee.com/israynotarray" target="_blank" style="text-decoration: none !important;border: 0px !important;">
        <img src="https://cdn.buymeacoffee.com/buttons/v2/default-yellow.png" alt="Buy Me A Coffee" style="height: 60px !important;width: 217px !important;" >
      </a>
      ｜
      <a href="https://portaly.cc/israynotarray/support" target="_blank" style="text-decoration: none !important;border: 0px !important;">
        <img src="/images/logo.b91a6dbf.webp" alt="Buy Me A Coffee" style="height: 50px !important;background: #fff !important;border-radius: 5px !important;padding: 10px !important;" >
      </a>
    </div>
  </div>
</div>


</div>

            <div class="post-description">之前有分享過「超完整 Express Imgur 套件上傳教學」，所以這一篇就改來介紹 Firebase Storage 的上傳教學，而這一篇會盡可能流程步驟都說明清楚，因為這一塊也是稍微有一點複雜。</div>
        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><!-- markdownlint-disable MD033 -->

<p><img src="https://i.imgur.com/mJkWN51.png" alt="Firebase Storage"></p>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>之前有分享過「<a href="/nodejs/20220517/432259079/#Express-Imgur">超完整 Express Imgur 套件上傳教學</a>」，所以這一篇就改來介紹 Firebase Storage 的上傳教學，而這一篇會盡可能流程步驟都說明清楚，因為這一塊也是稍微有一點複雜。</p>
<blockquote>
<p><strong>Note</strong><br>畫面可能會隨著 Firebase 的更新而有所不同，但是大致上的流程應該是一樣的。</p>
</blockquote>
<h2 id="Firebase-事前準備"><a href="#Firebase-事前準備" class="headerlink" title="Firebase 事前準備"></a>Firebase 事前準備</h2><p>不管怎麼樣，有一些流程還是必須先做好才能進入開發，所以前面就會先帶一下 Firebase 的事前準備。</p>
<h3 id="建立-Firebase-專案"><a href="#建立-Firebase-專案" class="headerlink" title="建立 Firebase 專案"></a>建立 Firebase 專案</h3><p>首先開啟 <a target="_blank" rel="noopener" href="https://firebase.google.com/">Firebase</a>，並且點選右上角的「轉到控制台」</p>
<p><img src="https://firebasestorage.googleapis.com/v0/b/welcomewebworld-4097b.appspot.com/o/blogImg%2Ffirebase%2Ffirebase-express%2F%E6%88%AA%E5%9C%96%202022-12-23%2022.34.31.png?alt=media&token=e4b53259-8a28-4062-a4c8-db33056e052d" alt="轉到控制台"></p>
<p>接著點「新增專案」、「建立專案」</p>
<p><img src="https://firebasestorage.googleapis.com/v0/b/welcomewebworld-4097b.appspot.com/o/blogImg%2Ffirebase%2Ffirebase-express%2F202212232237.jpg?alt=media&token=46e28e0c-f00d-40c4-a747-c7d56bd182fd" alt="新增專案"></p>
<p>當你點了「建立專案」後，就會跳出一個滿版的視窗，這邊就是你要輸入專案名稱的地方，基本上你可以隨便取，但是我這邊就取「Firebase-Express」，接著按下「繼續」</p>
<p><img src="https://firebasestorage.googleapis.com/v0/b/welcomewebworld-4097b.appspot.com/o/blogImg%2Ffirebase%2Ffirebase-express%2F%E6%88%AA%E5%9C%96%202022-12-23%2022.44.13.png?alt=media&token=8f380d4c-20ab-4f82-972b-923d5d29f96c" alt="專案名稱"></p>
<p>第二步驟是 Firebase 問你要不要開啟 Google Analytics(分析)，但這邊我們並不需要，所以就「關閉」並按下「建立專案」</p>
<p><img src="https://firebasestorage.googleapis.com/v0/b/welcomewebworld-4097b.appspot.com/o/blogImg%2Ffirebase%2Ffirebase-express%2F%E6%88%AA%E5%9C%96%202022-12-23%2022.48.20.png?alt=media&token=d8e5f50d-0a39-411a-8987-e97f121b07b4" alt="Google Analytics(分析)"></p>
<p>建立過程會稍微等一下，你去上個廁所就好了</p>
<p><img src="https://firebasestorage.googleapis.com/v0/b/welcomewebworld-4097b.appspot.com/o/blogImg%2Ffirebase%2Ffirebase-express%2F%E6%88%AA%E5%9C%96%202022-12-23%2022.49.19.png?alt=media&token=6d613fff-ebd2-4fd4-9f5e-74bb0180b8e5" alt="建立中"></p>
<p>準備好後，就按一下「繼續」</p>
<p><img src="https://firebasestorage.googleapis.com/v0/b/welcomewebworld-4097b.appspot.com/o/blogImg%2Ffirebase%2Ffirebase-express%2F%E6%88%AA%E5%9C%96%202022-12-23%2022.49.55.png?alt=media&token=5f3f97a1-6cbe-44d0-856a-599c1c562da5" alt="新專案已準備就緒"></p>
<p>這時候你應該會直接進入到你的專案控制台，到這邊為止你的 Firebase 專案就準備完成了</p>
<p><img src="https://firebasestorage.googleapis.com/v0/b/welcomewebworld-4097b.appspot.com/o/blogImg%2Ffirebase%2Ffirebase-express%2F%E6%88%AA%E5%9C%96%202022-12-23%2022.50.39.png?alt=media&token=b2e18403-c7ea-4a9a-a6b3-00796973187f" alt="完成"></p>
<h3 id="設定-Firebase-Storage"><a href="#設定-Firebase-Storage" class="headerlink" title="設定 Firebase Storage"></a>設定 Firebase Storage</h3><p>接下來你必須設置 Firebase Storage 的儲存區域，所以請你點一下左側功能列表找到「Storage」</p>
<p><img src="https://firebasestorage.googleapis.com/v0/b/welcomewebworld-4097b.appspot.com/o/blogImg%2Ffirebase%2Ffirebase-express%2F%E6%88%AA%E5%9C%96%202022-12-24%2012.46.32.png?alt=media&token=7c240880-dd87-4074-87dc-3e5295199a65" alt="storage"></p>
<p>接著點一下畫面「開始使用」</p>
<p><img src="https://firebasestorage.googleapis.com/v0/b/welcomewebworld-4097b.appspot.com/o/blogImg%2Ffirebase%2Ffirebase-express%2F%E6%88%AA%E5%9C%96%202022-12-24%2013.37.04.png?alt=media&token=20e7bafc-0973-42bb-bde2-258fa1b7ade8" alt="開始使用"></p>
<p>當你點了開始使用後，會跳出「設定 Cloud Storage」的視窗，這邊建議選「以正式模式啟動」</p>
<p><img src="https://firebasestorage.googleapis.com/v0/b/welcomewebworld-4097b.appspot.com/o/blogImg%2Ffirebase%2Ffirebase-express%2F%E6%88%AA%E5%9C%96%202022-12-24%2014.57.00.png?alt=media&token=da01d5cf-ce40-4800-ae69-b650f25513f8" alt="以正式模式啟動"></p>
<p>接著會需要選取 Storage 的地區，通常預設是 <code>us-central</code>，而這邊我們沒有必要去調整，所以你可以直接按下「完成」</p>
<p><img src="https://firebasestorage.googleapis.com/v0/b/welcomewebworld-4097b.appspot.com/o/blogImg%2Ffirebase%2Ffirebase-express%2F%E6%88%AA%E5%9C%96%202022-12-24%2015.01.36.png?alt=media&token=bc70790f-f0c8-4dc7-863e-ec39b23fa4c5" alt="Storage 地區"></p>
<p>過程中會稍微等一下…</p>
<p><img src="https://firebasestorage.googleapis.com/v0/b/welcomewebworld-4097b.appspot.com/o/blogImg%2Ffirebase%2Ffirebase-express%2F%E6%88%AA%E5%9C%96%202022-12-24%2015.03.30.png?alt=media&token=047613d6-31a1-4c37-8b44-48e314cc0366" alt="等待中..."></p>
<p>當你看到這個畫面，就代表你的 Storage 已經設定完成了</p>
<p><img src="https://firebasestorage.googleapis.com/v0/b/welcomewebworld-4097b.appspot.com/o/blogImg%2Ffirebase%2Ffirebase-express%2F%E6%88%AA%E5%9C%96%202022-12-24%2015.04.01.png?alt=media&token=b7ab7541-81f8-4551-a940-bcb67c2b78bc" alt="設定完成"></p>
<blockquote>
<p><strong>Note</strong><br>你如果不打算串接後端 API 你也可以直接在這個視窗上傳圖片。<br>但是如果你想要串接後端 API，那你就必須往後看唷！</p>
</blockquote>
<h3 id="取得-Firebase-Admin-SDK"><a href="#取得-Firebase-Admin-SDK" class="headerlink" title="取得 Firebase Admin SDK"></a>取得 Firebase Admin SDK</h3><p>接著由於我們需要上傳圖片，因此會使用到 Firebase Admin SDK，所以接著就來取得這個 SDK 吧！</p>
<p>首先點一下上方「齒輪」 &#x3D;&gt; 「專案設定」</p>
<p><img src="https://firebasestorage.googleapis.com/v0/b/welcomewebworld-4097b.appspot.com/o/blogImg%2Ffirebase%2Ffirebase-express%2F%E6%88%AA%E5%9C%96%202022-12-23%2023.05.46.png?alt=media&token=7ad005bc-2a5a-4958-9c36-e09ee40b888c" alt="專案設定"></p>
<p>接著再點一下「服務帳號」，你就可以看到 Firebase Admin SDK 的頁面</p>
<p><img src="https://firebasestorage.googleapis.com/v0/b/welcomewebworld-4097b.appspot.com/o/blogImg%2Ffirebase%2Ffirebase-express%2F%E6%88%AA%E5%9C%96%202022-12-23%2023.29.37.png?alt=media&token=1a9b6822-90c2-41ad-8601-47df2e5e6dbf" alt="Firebase Admin SDK"></p>
<p>最後你只要按一下「產生新的私密金鑰」(你可以依照你的程式語言生成範例程式碼)，就可以取得你的 Firebase Admin SDK 金鑰，接著請把這份 JSON 檔案保存好，後面我們會使用。</p>
<blockquote>
<p><strong>Danger</strong><br>請不要隨意將金鑰提供給別人<br>請不要將這個金鑰放到你的 GitHub 上（如果你真這樣幹，請你把這個儲存庫刪除並重新生成一個新的金鑰吧。）</p>
</blockquote>
<p>到目前為止，我們已經準備好了 Firebase 的事前準備，接著就準備進入寫程式的部分吧。</p>
<h2 id="Express-Firebase"><a href="#Express-Firebase" class="headerlink" title="Express + Firebase"></a>Express + Firebase</h2><p>接下來就是建立 Express 的部分，這邊我會使用 Express 產生器來建立一個新的專案，如果你還沒有安裝 Express 產生器，建議你可以先安裝一下，這樣可以讓你的開發速度更快</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g express-generator</span><br></pre></td></tr></table></figure>

<h3 id="建立-Express-專案"><a href="#建立-Express-專案" class="headerlink" title="建立 Express 專案"></a>建立 Express 專案</h3><p>前面有提到我們會使用 Express 產生器來建立一個新的專案，所以這邊我就直接提供我使用的指令給你，讓你快速建立</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">express --view=ejs firebase-express</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> firebase-express</span><br><span class="line"></span><br><span class="line">npm install</span><br></pre></td></tr></table></figure>

<h3 id="建立-upload-資料夾"><a href="#建立-upload-資料夾" class="headerlink" title="建立 upload 資料夾"></a>建立 upload 資料夾</h3><p>接下來請你在 routes 底下建立一個 upload.js 的檔案，並貼入以下程式碼</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> router = express.<span class="title class_">Router</span>();</span><br><span class="line"></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/image&#x27;</span>, upload.<span class="title function_">single</span>(<span class="string">&#x27;file&#x27;</span>), <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">  res.<span class="title function_">send</span>(&#123;</span><br><span class="line">    <span class="attr">imgUrl</span>: <span class="string">&#x27;https://israynotarray.com/&#x27;</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router;</span><br></pre></td></tr></table></figure>

<p>接著請記得要在 app.js 中引入這個檔案</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> uploadRouter = <span class="built_in">require</span>(<span class="string">&#x27;./routes/upload&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ... 略過</span></span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&#x27;/upload&#x27;</span>, uploadRouter);</span><br></pre></td></tr></table></figure>

<p>不出意外的話，這時候你輸入 <code>npm start</code> 是可以透過 <code>http://localhost:3000/upload/image</code> 來測試你的 API 是否正常運作的，而這邊我推薦可以使用 <a href="/other/20211207/427026/">Postman</a> 來測試，因為這樣可以讓你更清楚的看到你的 API 回傳的資料。</p>
<h3 id="安裝相關套件"><a href="#安裝相關套件" class="headerlink" title="安裝相關套件"></a>安裝相關套件</h3><p>接下來我們要安裝幾個套件</p>
<ul>
<li>dotenv<ul>
<li>這個套件可以讓你在程式中使用環境變數</li>
</ul>
</li>
<li>firebase-admin<ul>
<li>這個套件可以讓你使用 Firebase 的 Admin SDK</li>
</ul>
</li>
<li>multer<ul>
<li>這個套件可以讓你處理上傳檔案的相關事務</li>
</ul>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install dotenv firebase-admin multer</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>Note</strong><br>firebase 除了有提供 <strong>firebase-admin</strong> 套件之外，還有另一個叫做 <strong>firebase</strong> 的套件，這兩個套件很常被搞混，因為不清楚用途。<br>那麼，這兩個套件的差別是什麼呢？<br><strong>firebase-admin</strong>：這個套件可以讓你使用 Firebase 的 Admin SDK，而這個套件可以讓你使用 Firebase 的所有功能，包含認證、資料庫、儲存空間等等。<br><strong>firebase</strong>：這個套件可以讓你使用 Firebase 的 Client SDK，而這個套件只能讓你使用 Firebase 的部分功能，例如：認證、儲存空間等等。</p>
</blockquote>
<h3 id="建立-env-檔案"><a href="#建立-env-檔案" class="headerlink" title="建立 .env 檔案"></a>建立 .env 檔案</h3><p>接著請你在專案根目錄下建立一個 <code>.env</code> 檔案，內容如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">FIREBASE_TYPE=</span><br><span class="line">FIREBASE_PROJECT_ID=</span><br><span class="line">FIREBASE_PRIVATE_KEY_ID=</span><br><span class="line">FIREBASE_PRIVATE_KEY=</span><br><span class="line">FIREBASE_CLIENT_EMAIL=</span><br><span class="line">FIREBASE_CLIENT_ID=</span><br><span class="line">FIREBASE_AUTH_URI=</span><br><span class="line">FIREBASE_TOKEN_URI=</span><br><span class="line">FIREBASE_AUTH_PROVIDER_X509_CERT_URL=</span><br><span class="line">FIREBASE_CLIENT_X509_CERT_URL=</span><br></pre></td></tr></table></figure>

<p>而這邊都會對應到你在「取得 Firebase Admin SDK」小節時所取得的 JSON 資料，請你將對應的資料填入 <code>.env</code> 檔案中。</p>
<blockquote>
<p><strong>Note</strong><br>接入 Env 資訊的時候，你可以把 <code>.env</code> 檔案加入到 <code>.gitignore</code> 中，這樣就可以避免你的資訊被其他人看到。</p>
</blockquote>
<p>接著請你在專案根目錄下建立一個 <code>connection/firebase.js</code> 檔案，內容如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;dotenv&#x27;</span>).<span class="title function_">config</span>();</span><br><span class="line"><span class="keyword">const</span> admin = <span class="built_in">require</span>(<span class="string">&quot;firebase-admin&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> config = &#123;</span><br><span class="line">  <span class="attr">type</span>: process.<span class="property">env</span>.<span class="property">FIREBASE_TYPE</span>,</span><br><span class="line">  <span class="attr">project_id</span>: process.<span class="property">env</span>.<span class="property">FIREBASE_PROJECT_ID</span>,</span><br><span class="line">  <span class="attr">private_key_id</span>: process.<span class="property">env</span>.<span class="property">FIREBASE_PRIVATE_KEY_ID</span>,</span><br><span class="line">  <span class="attr">private_key</span>: process.<span class="property">env</span>.<span class="property">FIREBASE_PRIVATE_KEY</span>.<span class="title function_">replace</span>(<span class="regexp">/\\n/g</span>, <span class="string">&#x27;\n&#x27;</span>),</span><br><span class="line">  <span class="attr">client_email</span>: process.<span class="property">env</span>.<span class="property">FIREBASE_CLIENT_EMAIL</span>,</span><br><span class="line">  <span class="attr">client_id</span>: process.<span class="property">env</span>.<span class="property">FIREBASE_CLIENT_ID</span>,</span><br><span class="line">  <span class="attr">auth_uri</span>: process.<span class="property">env</span>.<span class="property">FIREBASE_AUTH_URI</span>,</span><br><span class="line">  <span class="attr">token_uri</span>: process.<span class="property">env</span>.<span class="property">FIREBASE_TOKEN_URI</span>,</span><br><span class="line">  <span class="attr">auth_provider_X509_cert_url</span>: process.<span class="property">env</span>.<span class="property">FIREBASE_AUTH_PROVIDER_X509_CERT_URL</span>,</span><br><span class="line">  <span class="attr">client_x509_cert_url</span>: process.<span class="property">env</span>.<span class="property">FIREBASE_CLIENT_X509_CERT_URL</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">admin.<span class="title function_">initializeApp</span>(&#123;</span><br><span class="line">  <span class="attr">credential</span>: admin.<span class="property">credential</span>.<span class="title function_">cert</span>(config),</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = admin;</span><br></pre></td></tr></table></figure>

<p>接著只需要回到 <code>routes/upload.js</code> 檔案引入 <code>connection/firebase.js</code> 檔案即可</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> firebaseAdmin = <span class="built_in">require</span>(<span class="string">&#x27;../connection/firebase&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//...略</span></span><br></pre></td></tr></table></figure>

<p>接下來我們會準備實作一下上傳功能，那麼<a target="_blank" rel="noopener" href="https://firebase.google.com/docs/storage/admin/start">官方文件</a>有提供以下這一段程式碼</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; initializeApp, cert &#125; = <span class="built_in">require</span>(<span class="string">&#x27;firebase-admin/app&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; getStorage &#125; = <span class="built_in">require</span>(<span class="string">&#x27;firebase-admin/storage&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> serviceAccount = <span class="built_in">require</span>(<span class="string">&#x27;./path/to/serviceAccountKey.json&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_">initializeApp</span>(&#123;</span><br><span class="line">  <span class="attr">credential</span>: <span class="title function_">cert</span>(serviceAccount),</span><br><span class="line">  <span class="attr">storageBucket</span>: <span class="string">&#x27;&lt;BUCKET_NAME&gt;.appspot.com&#x27;</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> bucket = <span class="title function_">getStorage</span>().<span class="title function_">bucket</span>();</span><br></pre></td></tr></table></figure>

<p>那麼你會發現這邊有一個 <code>&lt;BUCKET_NAME&gt;.appspot.com</code>，<code>&lt;BUCKET_NAME&gt;</code> 其實就是你在 Firebase 建立專案時所取得的專案名稱，而 <code>.appspot.com</code> 則是固定的，如果你找不到你也可以看看你的 Firebase 專案的網址，例如：<code>https://&lt;BUCKET_NAME&gt;.firebaseapp.com</code>，那麼 <code>&lt;BUCKET_NAME&gt;</code> 就是你的專案名稱</p>
<p><img src="https://firebasestorage.googleapis.com/v0/b/welcomewebworld-4097b.appspot.com/o/blogImg%2Ffirebase%2Ffirebase-express%2F%E6%88%AA%E5%9C%96%202022-12-24%2017.05.53.png?alt=media&token=446ba542-3307-47dd-8fa6-eff16a843ae8" alt="BUCKET_NAME"></p>
<p>而剛好 <code>BUCKET_NAME</code> 就是我們 <code>.env</code> 中的 <code>FIREBASE_PROJECT_ID</code>，所以我們可以把 <code>FIREBASE_PROJECT_ID</code> 的值填入 <code>storageBucket</code>，所以這邊打開 <code>connection/firebase.js</code> 檔案，修改如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;dotenv&#x27;</span>).<span class="title function_">config</span>();</span><br><span class="line"><span class="keyword">const</span> admin = <span class="built_in">require</span>(<span class="string">&quot;firebase-admin&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> config = &#123;</span><br><span class="line">  <span class="attr">type</span>: process.<span class="property">env</span>.<span class="property">FIREBASE_TYPE</span>,</span><br><span class="line">  <span class="attr">project_id</span>: process.<span class="property">env</span>.<span class="property">FIREBASE_PROJECT_ID</span>,</span><br><span class="line">  <span class="attr">private_key_id</span>: process.<span class="property">env</span>.<span class="property">FIREBASE_PRIVATE_KEY_ID</span>,</span><br><span class="line">  <span class="attr">private_key</span>: process.<span class="property">env</span>.<span class="property">FIREBASE_PRIVATE_KEY</span>.<span class="title function_">replace</span>(<span class="regexp">/\\n/g</span>, <span class="string">&#x27;\n&#x27;</span>),</span><br><span class="line">  <span class="attr">client_email</span>: process.<span class="property">env</span>.<span class="property">FIREBASE_CLIENT_EMAIL</span>,</span><br><span class="line">  <span class="attr">client_id</span>: process.<span class="property">env</span>.<span class="property">FIREBASE_CLIENT_ID</span>,</span><br><span class="line">  <span class="attr">auth_uri</span>: process.<span class="property">env</span>.<span class="property">FIREBASE_AUTH_URI</span>,</span><br><span class="line">  <span class="attr">token_uri</span>: process.<span class="property">env</span>.<span class="property">FIREBASE_TOKEN_URI</span>,</span><br><span class="line">  <span class="attr">auth_provider_X509_cert_url</span>: process.<span class="property">env</span>.<span class="property">FIREBASE_AUTH_PROVIDER_X509_CERT_URL</span>,</span><br><span class="line">  <span class="attr">client_x509_cert_url</span>: process.<span class="property">env</span>.<span class="property">FIREBASE_CLIENT_X509_CERT_URL</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">admin.<span class="title function_">initializeApp</span>(&#123;</span><br><span class="line">  <span class="attr">credential</span>: admin.<span class="property">credential</span>.<span class="title function_">cert</span>(config),</span><br><span class="line">  <span class="attr">storageBucket</span>: <span class="string">`<span class="subst">$&#123;process.env.FIREBASE_PROJECT_ID&#125;</span>.appspot.com`</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = admin;</span><br></pre></td></tr></table></figure>

<p>到目前為止我們才將 Firebase 初始化完成，接著就準備來實現上傳功能吧。</p>
<h2 id="實作上傳功能"><a href="#實作上傳功能" class="headerlink" title="實作上傳功能"></a>實作上傳功能</h2><p>接下來我們要來實作上傳功能，首先前面我們有安裝一個套件叫做 <code>multer</code>，而這個套件就是專門拿來幫我們處理檔案的，所以這邊先在 <code>routes/upload.js</code> 加入以下程式碼</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> multer  = <span class="built_in">require</span>(<span class="string">&#x27;multer&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> upload = <span class="title function_">multer</span>(&#123;</span><br><span class="line">  <span class="attr">limits</span>: &#123;</span><br><span class="line">    <span class="attr">fileSize</span>: <span class="number">5</span> * <span class="number">1024</span> * <span class="number">1024</span>,  <span class="comment">// 5MB</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>上面的程式碼中，我們將檔案的大小限制再 5MB 以內。</p>
<p>接著由於 <code>multer</code> 是一個 Middleware，所以我們可以在 <code>router.post</code> 中加入 <code>upload.single(&#39;file&#39;)</code>，這邊的 <code>file</code> 就是我們在前端上傳時所使用的 <code>name</code>，所以這邊我們就可以在 <code>req.file</code> 中取得上傳的檔案資訊</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/image&#x27;</span>, upload.<span class="title function_">single</span>(<span class="string">&#x27;file&#x27;</span>), <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> file = req.<span class="property">file</span>;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(file);</span><br><span class="line">  res.<span class="title function_">send</span>(<span class="string">&#x27;上傳成功&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>接著你一樣可以先嘗試使用 Postman 戳戳看，看看是否有正確取得上傳的檔案資訊</p>
<p><img src="https://firebasestorage.googleapis.com/v0/b/welcomewebworld-4097b.appspot.com/o/blogImg%2Ffirebase%2Ffirebase-express%2F%E6%88%AA%E5%9C%96%202022-12-25%2000.07.31.png?alt=media&token=cedd4800-9208-4907-a51c-b6460e1dc69e" alt="Postman"></p>
<p>接下來我不得不說 Firebase 的文件關於這一塊的描述說明滿不清楚的，所以這一段我花了一點時間看文件，因此接下來我會區分上傳與取得檔案的網址來說明。</p>
<h3 id="上傳檔案"><a href="#上傳檔案" class="headerlink" title="上傳檔案"></a>上傳檔案</h3><p>首先我們要先建立 Storage 的 Bucket(儲存桶)，所以這邊我們要在 <code>routes/upload.js</code> 中加入以下程式碼</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> bucket = firebaseAdmin.<span class="title function_">storage</span>().<span class="title function_">bucket</span>();</span><br></pre></td></tr></table></figure>

<p>接著我們要將上傳的檔案存到 Storage 中，所以我們這邊要將路由修改成以下，底下我會盡可搭配註解說明</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/image&#x27;</span>, upload.<span class="title function_">single</span>(<span class="string">&#x27;file&#x27;</span>), <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">  <span class="comment">// 取得上傳的檔案資訊</span></span><br><span class="line">  <span class="keyword">const</span> file = req.<span class="property">file</span>;</span><br><span class="line">  <span class="comment">// 基於檔案的原始名稱建立一個 blob 物件</span></span><br><span class="line">  <span class="keyword">const</span> blob = bucket.<span class="title function_">file</span>(file.<span class="property">originalname</span>);</span><br><span class="line">  <span class="comment">// 建立一個可以寫入 blob 的物件</span></span><br><span class="line">  <span class="keyword">const</span> blobStream = blob.<span class="title function_">createWriteStream</span>()</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 監聽上傳狀態，當上傳完成時，會觸發 finish 事件</span></span><br><span class="line">  blobStream.<span class="title function_">on</span>(<span class="string">&#x27;finish&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&#x27;上傳成功&#x27;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 如果上傳過程中發生錯誤，會觸發 error 事件</span></span><br><span class="line">  blobStream.<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">send</span>(<span class="string">&#x27;上傳失敗&#x27;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 將檔案的 buffer 寫入 blobStream</span></span><br><span class="line">  blobStream.<span class="title function_">end</span>(file.<span class="property">buffer</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>這時候你在嘗試使用 Postman 上傳檔案，上傳成功後，你應該可以在 Firebase 的 Storage 中看到你上傳的檔案。</p>
<p><img src="https://firebasestorage.googleapis.com/v0/b/welcomewebworld-4097b.appspot.com/o/blogImg%2Ffirebase%2Ffirebase-express%2F%E6%88%AA%E5%9C%96%202022-12-25%2000.29.57.png?alt=media&token=4300e2cb-b2fb-49b2-89c7-e67556e4013b" alt="上傳檔案"></p>
<h3 id="取得檔案網址"><a href="#取得檔案網址" class="headerlink" title="取得檔案網址"></a>取得檔案網址</h3><p>雖然我們已經將檔案上傳了，但是卻沒有回傳檔案的網址，所以這邊我們要在上傳成功後，回傳檔案的網址，這邊我們要修改上面的程式碼，讓上傳成功後，回傳檔案的網址</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/image&#x27;</span>, upload.<span class="title function_">single</span>(<span class="string">&#x27;file&#x27;</span>), <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> file = req.<span class="property">file</span>;</span><br><span class="line">  <span class="keyword">const</span> blob = bucket.<span class="title function_">file</span>(file.<span class="property">originalname</span>);</span><br><span class="line">  <span class="keyword">const</span> blobStream = blob.<span class="title function_">createWriteStream</span>()</span><br><span class="line"></span><br><span class="line">  blobStream.<span class="title function_">on</span>(<span class="string">&#x27;finish&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 設定檔案的存取權限</span></span><br><span class="line">    <span class="keyword">const</span> config = &#123;</span><br><span class="line">      <span class="attr">action</span>: <span class="string">&#x27;read&#x27;</span>, <span class="comment">// 權限</span></span><br><span class="line">      <span class="attr">expires</span>: <span class="string">&#x27;12-31-2500&#x27;</span>, <span class="comment">// 網址的有效期限</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">// 取得檔案的網址</span></span><br><span class="line">    blob.<span class="title function_">getSignedUrl</span>(config, <span class="function">(<span class="params">err, imgUrl</span>) =&gt;</span> &#123;</span><br><span class="line">      res.<span class="title function_">send</span>(&#123;</span><br><span class="line">        imgUrl</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  blobStream.<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">send</span>(<span class="string">&#x27;上傳失敗&#x27;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  blobStream.<span class="title function_">end</span>(file.<span class="property">buffer</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>由於取得檔案的網址需要設定檔案的存取權限與有效期限，因此我刻意寫成 2500 年，其實這樣子也等同於永久，而且 <code>expires</code> 這個屬性是必填的，不然會出現 <code>Error: The expiration date provided was invalid.</code> 的錯誤。</p>
<p>這時候你再次使用 Postman 上傳檔案，上傳成功後，你應該可以在回傳的資料中看到檔案的網址。</p>
<blockquote>
<p><strong>Note</strong><br>Firebase 的 Storage 其實是使用了 Google Cloud Storage 來實作，所以你會發現在 Firebase 中的<a target="_blank" rel="noopener" href="https://firebase.google.com/docs/storage/admin/start">管理者</a>區塊只有提到開始使用，而沒有提到如何上傳檔案，因為這部分是由 Google Cloud Storage 來實作的，因此 Firebase 的文件才會有這一句話</p>
</blockquote>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">You can use the bucket references returned by the Admin SDK in conjunction with the official Google Cloud Storage client libraries to upload, download, and modify content in the buckets associated with your Firebase projects. Note that you do not have to authenticate Google Cloud Storage libraries when using the Firebase Admin SDK. The bucket references returned by the Admin SDK are already authenticated with the credentials used to initialize your Firebase app.</span><br></pre></td></tr></table></figure>

<h3 id="刪除檔案"><a href="#刪除檔案" class="headerlink" title="刪除檔案"></a>刪除檔案</h3><p>這邊也順便補充一下如何刪除上傳的檔案程式碼，這邊我也會補上註解</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">router.<span class="title function_">delete</span>(<span class="string">&#x27;/image&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">  <span class="comment">// 取得檔案名稱</span></span><br><span class="line">  <span class="keyword">const</span> fileName = req.<span class="property">query</span>.<span class="property">fileName</span>;</span><br><span class="line">  <span class="comment">// 取得檔案</span></span><br><span class="line">  <span class="keyword">const</span> blob = bucket.<span class="title function_">file</span>(fileName);</span><br><span class="line">  <span class="comment">// 刪除檔案</span></span><br><span class="line">  blob.<span class="title function_">delete</span>().<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&#x27;刪除成功&#x27;</span>);</span><br><span class="line">  &#125;).<span class="title function_">catch</span>(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">send</span>(<span class="string">&#x27;刪除失敗&#x27;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>Note</strong><br>如果圖片是放在資料夾底下的話，那麼就要包含資料夾一起傳給後端，例如 <code>images/截圖 2022-12-24 17.05.53.png</code>，這樣子才能正確的刪除檔案。</p>
</blockquote>
<h3 id="取得檔案名稱列表"><a href="#取得檔案名稱列表" class="headerlink" title="取得檔案名稱列表"></a>取得檔案名稱列表</h3><p>當然我也會補上取得檔案名稱列表的程式碼</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/image&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">  <span class="comment">// 取得檔案列表</span></span><br><span class="line">  bucket.<span class="title function_">getFiles</span>().<span class="title function_">then</span>(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> files = data[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">const</span> fileList = [];</span><br><span class="line">    files.<span class="title function_">forEach</span>(<span class="function">(<span class="params">file</span>) =&gt;</span> &#123;</span><br><span class="line">      fileList.<span class="title function_">push</span>(file.<span class="property">name</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    res.<span class="title function_">send</span>(fileList);</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">catch</span>(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">send</span>(<span class="string">&#x27;取得檔案列表失敗&#x27;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>如果是想要包含連結的話，則改成以下</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/image&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">  <span class="comment">// 取得檔案列表</span></span><br><span class="line">  bucket.<span class="title function_">getFiles</span>().<span class="title function_">then</span>(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> data[<span class="number">0</span>]</span><br><span class="line">  &#125;).<span class="title function_">then</span>(<span class="function">(<span class="params">files</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> fileList = [];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> file <span class="keyword">of</span> files) &#123;</span><br><span class="line">      <span class="comment">// 取得檔案的簽署 URL</span></span><br><span class="line">      <span class="keyword">const</span> fileUrl = <span class="keyword">await</span> file.<span class="title function_">getSignedUrl</span>(&#123;</span><br><span class="line">        <span class="attr">action</span>: <span class="string">&#x27;read&#x27;</span>,</span><br><span class="line">        <span class="attr">expires</span>: <span class="string">&#x27;03-09-2491&#x27;</span></span><br><span class="line">      &#125;);</span><br><span class="line">      fileList.<span class="title function_">push</span>(&#123;</span><br><span class="line">        <span class="attr">fileName</span>: file.<span class="property">name</span>,</span><br><span class="line">        <span class="attr">imgUrl</span>: fileUrl</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    res.<span class="title function_">send</span>(fileList);</span><br><span class="line">  &#125;).<span class="title function_">catch</span>(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">send</span>(<span class="string">&#x27;取得檔案列表失敗&#x27;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>這樣就可以取得檔案名稱和連結了。</p>
<p><img src="https://firebasestorage.googleapis.com/v0/b/welcomewebworld-4097b.appspot.com/o/blogImg%2Ffirebase%2Ffirebase-express%2F%E6%88%AA%E5%9C%96%202022-12-25%2014.41.00.png?alt=media&token=a24719fb-b21a-44cc-bfda-2b1166117fd0" alt="檔案名稱與連結"></p>
<h3 id="指定上傳檔案到特定資料夾"><a href="#指定上傳檔案到特定資料夾" class="headerlink" title="指定上傳檔案到特定資料夾"></a>指定上傳檔案到特定資料夾</h3><p>其實我們上傳圖片的時候，都會希望可以分類，但其實這一段是非常簡單的，只需要在前面的程式碼中，將 <code>bucket.file(file.originalname)</code> 改成 <code>bucket.file(&#39;images/&#39; + file.originalname)</code>，這樣上傳的檔案就會被放到 <code>images</code> 資料夾中。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/image&#x27;</span>, upload.<span class="title function_">single</span>(<span class="string">&#x27;file&#x27;</span>), <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> file = req.<span class="property">file</span>;</span><br><span class="line">  <span class="comment">// 指定上傳的資料夾</span></span><br><span class="line">  <span class="keyword">const</span> blob = bucket.<span class="title function_">file</span>(<span class="string">`images/<span class="subst">$&#123;file.originalname&#125;</span>`</span>);</span><br><span class="line">  <span class="keyword">const</span> blobStream = blob.<span class="title function_">createWriteStream</span>()</span><br><span class="line"></span><br><span class="line">  blobStream.<span class="title function_">on</span>(<span class="string">&#x27;finish&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&#x27;上傳成功&#x27;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  blobStream.<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">send</span>(<span class="string">&#x27;上傳失敗&#x27;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  blobStream.<span class="title function_">end</span>(file.<span class="property">buffer</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>Note</strong><br>如果資料不存在的話，Firebase 會自動幫你建立資料夾唷！</p>
</blockquote>
<h2 id="中途小結"><a href="#中途小結" class="headerlink" title="中途小結"></a>中途小結</h2><p>前面我們分別學習了上傳、取得檔案連結、刪除檔案、檔案列表等語法，這些都可以說是我們上傳檔案的基礎，但這一段其實我們缺少了一些地方，例如上傳檔案後應重新命名避免檔名重複以及先壓縮圖片後再上傳到 Firebase，所以後面就讓我們接著補充這些吧。</p>
<h2 id="加碼補充"><a href="#加碼補充" class="headerlink" title="加碼補充"></a>加碼補充</h2><p>接著這邊我額外補充一些我們上傳檔案時會需要的功能，例如重新命名檔案、壓縮圖片等等重點</p>
<h3 id="重新命名檔案"><a href="#重新命名檔案" class="headerlink" title="重新命名檔案"></a>重新命名檔案</h3><p>重新命名檔案的方式非常簡單，通常檔案名稱會有幾種方式</p>
<ul>
<li>時間戳記</li>
<li>uuid</li>
<li>亂數</li>
</ul>
<p>而這邊我們就使用 uuid 來重新命名檔案，那什麼是 uuid 呢？uuid 中文名稱是「通用唯一辨識碼(Universally Unique Identifier)」，並且它的重複機率是趨近於零，所以我們可以安心的使用它來重新命名檔案。</p>
<p>在那之前你必須先替專案安裝 uuid 套件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install uuid</span><br></pre></td></tr></table></figure>

<p>接著再來修改上傳檔案的程式碼</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; <span class="attr">v4</span>: uuidv4 &#125; = <span class="built_in">require</span>(<span class="string">&#x27;uuid&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//...略過</span></span><br><span class="line"></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/image&#x27;</span>, upload.<span class="title function_">single</span>(<span class="string">&#x27;file&#x27;</span>), <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> file = req.<span class="property">file</span>;</span><br><span class="line">  <span class="comment">// 指定上傳的資料夾並將檔案重新命名，請記得補上副檔名</span></span><br><span class="line">  <span class="keyword">const</span> blob = bucket.<span class="title function_">file</span>(<span class="string">`images/<span class="subst">$&#123;uuidv4()&#125;</span>.<span class="subst">$&#123;file.originalname.split(<span class="string">&#x27;.&#x27;</span>).pop()&#125;</span>`</span>);</span><br><span class="line">  <span class="keyword">const</span> blobStream = blob.<span class="title function_">createWriteStream</span>()</span><br><span class="line"></span><br><span class="line">  blobStream.<span class="title function_">on</span>(<span class="string">&#x27;finish&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&#x27;上傳成功&#x27;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  blobStream.<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">send</span>(<span class="string">&#x27;上傳失敗&#x27;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  blobStream.<span class="title function_">end</span>(file.<span class="property">buffer</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>這樣你的檔案上傳時，就會重新命名了</p>
<p><img src="https://firebasestorage.googleapis.com/v0/b/welcomewebworld-4097b.appspot.com/o/blogImg%2Ffirebase%2Ffirebase-express%2F%E6%88%AA%E5%9C%96%202022-12-25%2014.03.34.png?alt=media&token=607923fa-53e1-4267-a475-6510cfcca4c8" alt="重新命名"></p>
<h3 id="壓縮圖片-TinyPNG"><a href="#壓縮圖片-TinyPNG" class="headerlink" title="壓縮圖片(TinyPNG)"></a>壓縮圖片(TinyPNG)</h3><p>接著我們要來壓縮圖片，壓縮圖片的方式滿多種的，但是這邊我們將會使用 TinyPNG 來壓縮圖片，而 TinyPNG 是一個圖片壓縮服務，它可以將圖片壓縮到原本的 1&#x2F;3，而且它的壓縮品質也不會有太大的差異，所以我們可以安心的使用它來壓縮圖片。</p>
<blockquote>
<p><strong>Note</strong><br>免費版的 TinyPNG 有一個限制要稍微注意一下，就是每個月只能壓縮 500 張圖片。</p>
</blockquote>
<p>一開始你必須先申請一個 TinyPNG 的帳號，請你先到<a target="_blank" rel="noopener" href="https://tinypng.com/developers">這個</a>頁面申請</p>
<p><img src="https://firebasestorage.googleapis.com/v0/b/welcomewebworld-4097b.appspot.com/o/blogImg%2Ffirebase%2Ffirebase-express%2F%E6%88%AA%E5%9C%96%202022-12-25%2016.09.33.png?alt=media&token=19f91bdb-137a-4a34-9736-c7c2bab941a3" alt="TinyPNG"></p>
<p>接著你就會收到一封信，裡面會有進入 TinyPNG 的網址</p>
<p><img src="https://firebasestorage.googleapis.com/v0/b/welcomewebworld-4097b.appspot.com/o/blogImg%2Ffirebase%2Ffirebase-express%2F%E6%88%AA%E5%9C%96%202022-12-25%2016.11.51.png?alt=media&token=c60bbd76-c8af-4a03-b042-d3e95743863c" alt="信件"></p>
<p>點擊後，基本上你就可以到達 TinyPNG 的後台，裡面會有一組 API Key 先將它複製下來</p>
<p><img src="https://firebasestorage.googleapis.com/v0/b/welcomewebworld-4097b.appspot.com/o/blogImg%2Ffirebase%2Ffirebase-express%2F202212251613.jpg?alt=media&token=83fe1598-75f4-4828-adec-98c35eec236e" alt="API Key"></p>
<p>接著就是安裝 TinyPNG 的套件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install tinify</span><br></pre></td></tr></table></figure>

<p>並將 API Key 設定到環境變數</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TINYPNG_API_KEY=</span><br></pre></td></tr></table></figure>

<p>接下來就是修改上傳檔案的程式碼就可以囉~</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> tinify = <span class="built_in">require</span>(<span class="string">&quot;tinify&quot;</span>);</span><br><span class="line">tinify.<span class="property">key</span> = process.<span class="property">env</span>.<span class="property">TINYPNG_API_KEY</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//...略過</span></span><br><span class="line"></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/image&#x27;</span>, upload.<span class="title function_">single</span>(<span class="string">&#x27;file&#x27;</span>), <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> file = req.<span class="property">file</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 上傳圖片到 TinyPNG 並壓縮</span></span><br><span class="line">  tinify.<span class="title function_">fromBuffer</span>(file.<span class="property">buffer</span>).<span class="title function_">toBuffer</span>(<span class="keyword">function</span>(<span class="params">err, resultData</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> blob = bucket.<span class="title function_">file</span>(<span class="string">`images/<span class="subst">$&#123;uuidv4()&#125;</span>.<span class="subst">$&#123;file.originalname.split(<span class="string">&#x27;.&#x27;</span>).pop()&#125;</span>`</span>);</span><br><span class="line">    <span class="keyword">const</span> blobStream = blob.<span class="title function_">createWriteStream</span>()</span><br><span class="line"></span><br><span class="line">    blobStream.<span class="title function_">on</span>(<span class="string">&#x27;finish&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      res.<span class="title function_">send</span>(<span class="string">&#x27;上傳成功&#x27;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    blobStream.<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">      res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">send</span>(<span class="string">&#x27;上傳失敗&#x27;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 將壓縮後的圖片上傳到 Firebase Storage</span></span><br><span class="line">    blobStream.<span class="title function_">end</span>(resultData);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>接著你再去看看你的 Firebase Storage，你會發現你的圖片已經被壓縮，底下這兩個都是相同的圖片，一個是未壓縮 21.47kb，另一個是被壓縮後 6.78kb</p>
<p><img src="https://firebasestorage.googleapis.com/v0/b/welcomewebworld-4097b.appspot.com/o/blogImg%2Ffirebase%2Ffirebase-express%2F%E6%88%AA%E5%9C%96%202022-12-25%2016.23.12.png?alt=media&token=68f84506-dadb-4f57-bad7-f9fa4d31f837" alt="壓縮前後"></p>
<blockquote>
<p><strong>Note</strong><br>TinyPNG 除了可以壓縮圖片之外，也可以調整圖片大小，詳細可以參考<a target="_blank" rel="noopener" href="https://tinypng.com/developers/reference/nodejs">官方文件</a>。<br>當然除了老牌的 TinyPNG 之外，也有 <a target="_blank" rel="noopener" href="https://kraken.io/docs/getting-started">Kraken.io</a> 可以使用唷。</p>
</blockquote>
<h2 id="結論"><a href="#結論" class="headerlink" title="結論"></a>結論</h2><p>這一篇稍微比較長一點，但是我想應該是滿詳細的了，畢竟 Firebase Storage 這一塊我發現在串接上真的滿複雜的，所以就乾脆把整個流程都給它記錄下來，如果你想要這份範例程式碼的話，我也放在 GitHub 上囉~</p>
<p><a target="_blank" rel="noopener" href="https://github.com/hsiangfeng/firebase-storage-example">GitHub</a></p>
<h2 id="參考文獻"><a href="#參考文獻" class="headerlink" title="參考文獻"></a>參考文獻</h2><ul>
<li><a target="_blank" rel="noopener" href="https://cloud.google.com/appengine/docs/flexible/using-cloud-storage?hl=zh-tw&tab=node.js#application_code">Application code</a></li>
<li><a target="_blank" rel="noopener" href="https://gist.github.com/stardustxx/58748550699228174b805aaadfc98a35">NodeJS Firebase Storage Sample</a></li>
<li><a target="_blank" rel="noopener" href="https://firebase.google.com/docs/reference/admin/node/firebase-admin.storage.storage">Firebase API reference Bucket</a></li>
<li><a target="_blank" rel="noopener" href="https://firebase.google.com/docs/storage/admin/start">Admin Cloud Storage API</a></li>
<li><a target="_blank" rel="noopener" href="https://kraken.io/docs/getting-started">Kraken API Reference</a></li>
<li><a target="_blank" rel="noopener" href="https://tinypng.com/developers/reference/nodejs">TinyPNG API Reference</a></li>
</ul>

    </div>

    
    
    

    <footer class="post-footer"><div style="color: var(--text-color);">
  <h4>
    <i class="fas fa-heart"></i>
    請我喝一杯咖啡
  </h4>
  <div style="color: var(--text-color); border: 5px var(--text-color) dashed;padding: 20px;font-size: 14px;">
    這篇筆記文章如果對你有幫助，
    <br />
    你可以也可以請我「喝一杯咖啡(Donate)」。
    <br /><br />
    <div style="display: flex;justify-content: center;align-items: center;">
      <a href="https://www.buymeacoffee.com/israynotarray" target="_blank" style="text-decoration: none !important;border: 0px !important;">
        <img src="https://cdn.buymeacoffee.com/buttons/v2/default-yellow.png" alt="Buy Me A Coffee" style="height: 60px !important;width: 217px !important;" >
      </a>
      ｜
      <a href="https://portaly.cc/israynotarray/support" target="_blank" style="text-decoration: none !important;border: 0px !important;">
        <img src="/images/logo.b91a6dbf.webp" alt="Buy Me A Coffee" style="height: 50px !important;background: #fff !important;border-radius: 5px !important;padding: 10px !important;" >
      </a>
    </div>
  </div>
</div>
<div style="color: var(--text-color); width: 100%;">
  <div>
    <h4>
      <i class="fab fa-google"></i>
      Google AD
    </h4>
  </div>
  <div
    style="height: 90px; width: 100%; border: 5px var(--text-color) dashed;">
    <div class="message-block">
      <p style="color: var(--text-color); font-size: 0.75rem;margin: 0;">
        撰寫一篇文章其實真的很花時間，如果你願意<strong>「關閉 Adblock (廣告阻擋器)」</strong>來支持我的話，我會非常感謝你 ヽ(・∀・)ﾉ
      </p>
    </div>
    <!-- hsiangfeng_post_end -->
    <ins
      class="adsbygoogle"
      style="display:block;height: 90px; width: 100%;"
      data-ad-client="ca-pub-4319471747130190"
      data-ad-slot="3804716479"
      data-ad-format="auto"
      data-full-width-responsive="true">
    </ins>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
  </div>
</div>

          <div class="post-tags">
              <a href="/tags/Node-js/" rel="tag"># Node.js</a>
              <a href="/tags/Firebase/" rel="tag"># Firebase</a>
              <a href="/tags/Express/" rel="tag"># Express</a>
              <a href="/tags/Imgur/" rel="tag"># Imgur</a>
              <a href="/tags/Firebase-Storage/" rel="tag"># Firebase Storage</a>
              <a href="/tags/Storage/" rel="tag"># Storage</a>
              <a href="/tags/multer/" rel="tag"># multer</a>
              <a href="/tags/TinyPNG/" rel="tag"># TinyPNG</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/gsap/20221222/1131507457/" rel="prev" title="(11)前端好好玩用 GSAP 做一個特效 - 時間軸/線(2)">
                  <i class="fa fa-angle-left"></i> (11)前端好好玩用 GSAP 做一個特效 - 時間軸/線(2)
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/git/20221230/27133639/" rel="next" title="關於 Git 的檔案名稱大小寫問題與修正">
                  關於 Git 的檔案名稱大小寫問題與修正 <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments utterances-container"></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-user"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Ray - 轉載文章時請附上作者(Ray)及原文連結(Url)。</span>
  </div><div style="color: var(--text-color); width: 100%;">
  <div>
    <h4>
      <i class="fab fa-google"></i>
      Google AD
    </h4>
  </div>
  <div
    style="height: 90px; border: 5px var(--text-color) dashed;">
    <div class="message-block">
      <p style="color: var(--text-color);  font-size: 0.75rem;margin: 0;">
        撰寫一篇文章其實真的很花時間，如果你願意<strong>「關閉 Adblock (廣告阻擋器)」</strong>來支持我的話，我會非常感謝你 ヽ(・∀・)ﾉ
      </p>
    </div>
    <!-- hsiangfeng_bodyend -->
    <ins class="adsbygoogle"
        style="display:block"
        data-ad-client="ca-pub-4319471747130190"
        data-ad-slot="5395046960"
        data-ad-format="auto"
        data-full-width-responsive="true"></ins>
    <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
  </div>
  <script data-name="BMC-Widget" data-cfasync="false" src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js" data-id="israynotarray" data-description="Support me on Buy me a coffee!" data-message="" data-color="#5F7FFF" data-position="Right" data-x_margin="18" data-y_margin="18"></script>
</div>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="回到頂端">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

  <a href="https://github.com/hsiangfeng" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.24/fancybox/fancybox.umd.js" integrity="sha256-oyhjPiYRWGXaAt+ny/mTMWOnN1GBoZDUQnzzgC7FRI4=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/algoliasearch/4.20.0/algoliasearch-lite.umd.js" integrity="sha256-DABVk+hYj0mdUzo+7ViJC6cwLahQIejFvC+my2M/wfM=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/instantsearch.js/4.57.0/instantsearch.production.min.js" integrity="sha256-foJtB+Wd0wvvK+VU3KO0/H6CjwSwJfB1RnWlgx0Ov9U=" crossorigin="anonymous"></script><script src="/js/third-party/search/algolia-search.js"></script>




  <script src="/js/third-party/fancybox.js"></script>



  




<script class="next-config" data-name="utterances" type="application/json">{"enable":true,"repo":"hsiangfeng/hsiangfeng.github.io","issue_term":"pathname","theme":"github-dark"}</script>
<script src="/js/third-party/comments/utterances.js"></script>

</body>
</html>
