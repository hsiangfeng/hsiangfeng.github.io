<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png">
  <link rel="mask-icon" href="/images/favicon.png" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha256-CTSx/A06dm1B063156EVh15m6Y67pAjZZaQc89LLSrU=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.24/fancybox/fancybox.css" integrity="sha256-vQkngPS8jiHHH0I6ABTZroZk8NPZ7b+MUReOFE9UsXQ=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"israynotarray.com","root":"/","images":"/images","scheme":"Pisces","darkmode":true,"version":"8.18.2","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":"mac"},"fold":{"enable":false,"height":800},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":false,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜尋...","empty":"我們無法找到任何有關 ${query} 的搜索結果","hits_time":"${hits} 找到 ${time} 個結果","hits":"找到 ${hits} 個結果"},"algolia":{"appID":"MU7N4K4R36","apiKey":"110ed15d0a4842310bafc6fdfda119c4","indexName":"blog","hits":{"per_page":10}}}</script><script src="/js/config.js"></script>

    <meta name="description" content="這一篇我將會記錄一下如何用 Nodemailer 來發送 Email，而這一篇將會記錄使用 Gmail 以及 OAuth2 跟帳號密碼（應用程式密碼）的兩種方式來發送 Email。">
<meta property="og:type" content="article">
<meta property="og:title" content="Node.js 應用篇 - 使用 Nodemailer 來發送 Email">
<meta property="og:url" content="https://israynotarray.com/nodejs/20230722/1626712457/index.html">
<meta property="og:site_name" content="是 Ray 不是 Array">
<meta property="og:description" content="這一篇我將會記錄一下如何用 Nodemailer 來發送 Email，而這一篇將會記錄使用 Gmail 以及 OAuth2 跟帳號密碼（應用程式密碼）的兩種方式來發送 Email。">
<meta property="og:locale" content="zh_TW">
<meta property="og:image" content="https://firebasestorage.googleapis.com/v0/b/israynotarray2.appspot.com/o/blog2%2Fnodejs%2Fnodemailer-google-email%2F0_1.png?alt=media&token=5ceef9cb-0c31-44ed-8cdd-b302aa191a77">
<meta property="og:image" content="https://firebasestorage.googleapis.com/v0/b/israynotarray2.appspot.com/o/blog2%2Fnodejs%2Fnodemailer-google-email%2F202307211027.jpg?alt=media&token=001723af-ec44-43e9-8891-83ab76339577">
<meta property="og:image" content="https://firebasestorage.googleapis.com/v0/b/israynotarray2.appspot.com/o/blog2%2Fnodejs%2Fnodemailer-google-email%2F2023-07-21%2010.29.36.png?alt=media&token=c057f2c8-ce9a-487c-b8c3-646ca09f0900">
<meta property="og:image" content="https://firebasestorage.googleapis.com/v0/b/israynotarray2.appspot.com/o/blog2%2Fnodejs%2Fnodemailer-google-email%2F2023-07-21%2010.32.12.png?alt=media&token=6320dc13-4b2c-49ce-83af-893286d19349">
<meta property="og:image" content="https://firebasestorage.googleapis.com/v0/b/israynotarray2.appspot.com/o/blog2%2Fnodejs%2Fnodemailer-google-email%2F2023-07-21%2010.32.52.png?alt=media&token=4bb66e97-b044-49d9-aec6-387543e41692">
<meta property="og:image" content="https://firebasestorage.googleapis.com/v0/b/israynotarray2.appspot.com/o/blog2%2Fnodejs%2Fnodemailer-google-email%2F2023-07-21%2010.32.57.png?alt=media&token=56b2fdce-c60e-422c-8a19-80d27b62923f">
<meta property="og:image" content="https://firebasestorage.googleapis.com/v0/b/israynotarray2.appspot.com/o/blog2%2Fnodejs%2Fnodemailer-google-email%2F202307211035.jpg?alt=media&token=cc93b9b8-bdca-443e-b72c-6fc633010a68">
<meta property="og:image" content="https://firebasestorage.googleapis.com/v0/b/israynotarray2.appspot.com/o/blog2%2Fnodejs%2Fnodemailer-google-email%2F202307211102.jpg?alt=media&token=950d63e4-21d1-47ee-bcbe-6c2efd02893c">
<meta property="og:image" content="https://firebasestorage.googleapis.com/v0/b/israynotarray2.appspot.com/o/blog2%2Fnodejs%2Fnodemailer-google-email%2F202307211103.jpg?alt=media&token=86cae0d7-9a59-4808-bdde-59dcb6d0abf1">
<meta property="og:image" content="https://firebasestorage.googleapis.com/v0/b/israynotarray2.appspot.com/o/blog2%2Fnodejs%2Fnodemailer-google-email%2F202307211105.jpg?alt=media&token=3bc21c43-029e-41a1-9871-344d04f035a9">
<meta property="og:image" content="https://firebasestorage.googleapis.com/v0/b/israynotarray2.appspot.com/o/blog2%2Fnodejs%2Fnodemailer-google-email%2F202307211111.jpg?alt=media&token=adff4903-03c7-4d15-af48-3c3722311d97">
<meta property="og:image" content="https://firebasestorage.googleapis.com/v0/b/israynotarray2.appspot.com/o/blog2%2Fnodejs%2Fnodemailer-google-email%2F202307211115.jpg?alt=media&token=bd347292-b2e3-4742-ad32-f5d79f420a97">
<meta property="og:image" content="https://firebasestorage.googleapis.com/v0/b/israynotarray2.appspot.com/o/blog2%2Fnodejs%2Fnodemailer-google-email%2F2023-07-21%2011.18.55.png?alt=media&token=bba222db-5ba3-4430-a62b-83be313dbc80">
<meta property="og:image" content="https://firebasestorage.googleapis.com/v0/b/israynotarray2.appspot.com/o/blog2%2Fnodejs%2Fnodemailer-google-email%2F202307211128.jpg?alt=media&token=1d9d9299-1844-4066-8cdd-ad38620e2ada">
<meta property="og:image" content="https://firebasestorage.googleapis.com/v0/b/israynotarray2.appspot.com/o/blog2%2Fnodejs%2Fnodemailer-google-email%2F2023-07-21%2011.32.39.png?alt=media&token=a732d607-c93c-416d-8eaa-b88cae83c51f">
<meta property="og:image" content="https://firebasestorage.googleapis.com/v0/b/israynotarray2.appspot.com/o/blog2%2Fnodejs%2Fnodemailer-google-email%2F2023-07-21%2011.37.52.png?alt=media&token=8cd3a3f6-419d-4e92-b678-6caea0c5c5ab">
<meta property="og:image" content="https://firebasestorage.googleapis.com/v0/b/welcomewebworld-4097b.appspot.com/o/blogImg%2FNodejs%2F202104060914.png?alt=media&token=39874960-e1b7-4a72-8be3-78228cfda98f">
<meta property="og:image" content="https://firebasestorage.googleapis.com/v0/b/israynotarray2.appspot.com/o/blog2%2Fnodejs%2Fnodemailer-google-email%2F202307211438.jpg?alt=media&token=16303604-deea-4ea7-a391-3cba0399b30c">
<meta property="og:image" content="https://firebasestorage.googleapis.com/v0/b/israynotarray2.appspot.com/o/blog2%2Fnodejs%2Fnodemailer-google-email%2F202307211456.jpg?alt=media&token=0fd01b91-2e07-4f2b-8ba9-6c871435a753">
<meta property="og:image" content="https://firebasestorage.googleapis.com/v0/b/israynotarray2.appspot.com/o/blog2%2Fnodejs%2Fnodemailer-google-email%2F202307212044.jpg?alt=media&token=dff238b0-9224-4003-ba3b-dbffbb1f7c15">
<meta property="og:image" content="https://firebasestorage.googleapis.com/v0/b/israynotarray2.appspot.com/o/blog2%2Fnodejs%2Fnodemailer-google-email%2F202307212040.jpg?alt=media&token=d20075c2-40ff-4558-849a-71d5c1c8524e">
<meta property="og:image" content="https://firebasestorage.googleapis.com/v0/b/israynotarray2.appspot.com/o/blog2%2Fnodejs%2Fnodemailer-google-email%2F202307212041.jpg?alt=media&token=498575c3-3756-4cc7-b978-977466d75133">
<meta property="og:image" content="https://firebasestorage.googleapis.com/v0/b/israynotarray2.appspot.com/o/blog2%2Fnodejs%2Fnodemailer-google-email%2F2023-07-22%2012.19.15.png?alt=media&token=5d31780f-8cc3-4c01-b09c-a6514424b8ee">
<meta property="og:image" content="https://firebasestorage.googleapis.com/v0/b/israynotarray2.appspot.com/o/blog2%2Fnodejs%2Fnodemailer-google-email%2F2023-07-22%2012.43.25.png?alt=media&token=ae991a9b-64c4-437e-976d-f0d1da32e98b">
<meta property="og:image" content="https://firebasestorage.googleapis.com/v0/b/israynotarray2.appspot.com/o/blog2%2Fnodejs%2Fnodemailer-google-email%2F2023-07-22%2012.48.40.png?alt=media&token=e3759b0c-d785-46d0-bae8-cecd37d8554d">
<meta property="og:image" content="https://firebasestorage.googleapis.com/v0/b/israynotarray2.appspot.com/o/blog2%2Fnodejs%2Fnodemailer-google-email%2F2023-07-22%2012.49.34.png?alt=media&token=a46921fa-fb20-4fcf-8cd0-e64df8f5a333">
<meta property="og:image" content="https://firebasestorage.googleapis.com/v0/b/israynotarray2.appspot.com/o/blog2%2Fnodejs%2Fnodemailer-google-email%2F2023-07-22%2012.51.21.png?alt=media&token=dff32003-6253-43db-bea5-162561edbafc">
<meta property="og:image" content="https://firebasestorage.googleapis.com/v0/b/israynotarray2.appspot.com/o/blog2%2Fnodejs%2Fnodemailer-google-email%2F202307221252.jpg?alt=media&token=ec0a3ca3-81e4-4dd9-945b-ced415f23b25">
<meta property="og:image" content="https://firebasestorage.googleapis.com/v0/b/israynotarray2.appspot.com/o/blog2%2Fnodejs%2Fnodemailer-google-email%2F%E6%88%AA%E5%9C%96%202023-10-20%2014.05.41.png?alt=media&token=001676d6-cd2f-439b-a787-a95f52d9d5f7&_gl=1*1horus5*_ga*ODk0ODUxNTk2LjE2NDM0MjM0ODI.*_ga_CW55HF8NVT*MTY5Nzc4NDAxMi4xNDEuMS4xNjk3Nzg0MDY2LjYuMC4w">
<meta property="og:image" content="https://firebasestorage.googleapis.com/v0/b/israynotarray2.appspot.com/o/blog2%2Fnodejs%2Fnodemailer-google-email%2F%E6%88%AA%E5%9C%96%202023-10-20%2014.06.18.png?alt=media&token=6c252367-9d20-4c38-bb12-2ea9a91d215e&_gl=1*n7xw3w*_ga*ODk0ODUxNTk2LjE2NDM0MjM0ODI.*_ga_CW55HF8NVT*MTY5Nzc4NDAxMi4xNDEuMS4xNjk3Nzg0MTU0LjUzLjAuMA..">
<meta property="og:image" content="https://firebasestorage.googleapis.com/v0/b/israynotarray2.appspot.com/o/blog2%2Fnodejs%2Fnodemailer-google-email%2F%E6%88%AA%E5%9C%96_2023-10-20_14_06_26.jpg?alt=media&token=93ae0591-1e80-45c3-b4db-1a8e537e5a7d&_gl=1*1qo8d57*_ga*ODk0ODUxNTk2LjE2NDM0MjM0ODI.*_ga_CW55HF8NVT*MTY5Nzc4NDAxMi4xNDEuMS4xNjk3Nzg0MjYyLjE5LjAuMA..">
<meta property="article:published_time" content="2023-07-22T01:56:44.000Z">
<meta property="article:modified_time" content="2023-10-20T06:45:00.000Z">
<meta property="article:author" content="Ray">
<meta property="article:tag" content="Nodejs">
<meta property="article:tag" content="Nodemailer">
<meta property="article:tag" content="Gmail">
<meta property="article:tag" content="OAuth2">
<meta property="article:tag" content="Email">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://firebasestorage.googleapis.com/v0/b/israynotarray2.appspot.com/o/blog2%2Fnodejs%2Fnodemailer-google-email%2F0_1.png?alt=media&token=5ceef9cb-0c31-44ed-8cdd-b302aa191a77">


<link rel="canonical" href="https://israynotarray.com/nodejs/20230722/1626712457/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-TW","comments":true,"permalink":"https://israynotarray.com/nodejs/20230722/1626712457/","path":"nodejs/20230722/1626712457/","title":"Node.js 應用篇 - 使用 Nodemailer 來發送 Email"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Node.js 應用篇 - 使用 Nodemailer 來發送 Email | 是 Ray 不是 Array</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-FC8R6QFRC3"></script>
  <script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"G-FC8R6QFRC3","only_pageview":false}</script>
  <script src="/js/third-party/analytics/google-analytics.js"></script>




  <script type="text/javascript">
    (function(c,l,a,r,i,t,y){
        c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
        t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
        y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
    })(window, document, "clarity", "script", "h46z900dov");
</script>



<style>
  .message-block {
    color: black;
    display: none;
    justify-content: center;
    align-items: center;
    height: 100%;
  }
</style>
<script async="async" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
  window.onload = () => {
    setTimeout(() => {
      const ads = document.querySelector('ins.adsbygoogle');
      if(!ads.getAttribute('data-adsbygoogle-status')) {
        console.clear();
        console.log(`
        ██████╗██╗  ██╗    ███╗   ██╗██████╗     ██╗
        ██╔═══████║  ██║    ████╗  ████╔═══██╗    ██║
        ██║   █████████║    ██╔██╗ ████║   ██║    ██║
        ██║   ████╔══██║    ██║╚██╗████║   ██║    ╚═╝
        ╚██████╔██║  ██║    ██║ ╚████╚██████╔╝    ██╗
        ╚═════╝╚═╝  ╚═╝    ╚═╝  ╚═══╝╚═════╝     ╚═╝
        `);
        console.warn('RRRRヽ(*・ω・)ﾉ 廣告被阻擋了');
        console.warn('你都能發現這個彩蛋了，求你關閉 Adblock (廣告阻擋器) 支持我 ┭┮﹏┭┮')
        document.querySelector('.message-block').style.display = 'flex';
      } else {
        console.clear();
        console.info('你發現了這個毫無意義的彩蛋！但是我非常感謝你關閉 Adblock (廣告阻擋器) ㄟ(≧◇≦)ㄏ');
        console.info('因為你關閉 Adblock 也代表你支持我 (((o(*ﾟ▽ﾟ*)o)))')
        console.info('底下我也給你佛祖保佑的圖片，祝你開發順利 (๑•̀ㅂ•́)و✧')
        console.info(`
                             _oo0oo_
                            o8888888o
                            88" . "88
                            (| -_- |)
                            0\  =  /0
                          ___/'---'\___
                        .' \||     ||/ '.
                        / \||||  :  ||||/ |
                      | _||||| -:- |||||- |
                      |   | \|\  -  /|/ |   |
                      | \_|  ''\---/''  |_/ |
                      |  .-\__  '-'  ___/-. |
                    ___'. .'  /--.--\  '. .'___
                ."" '<  '.___\_<|>_/___.' >' "".
                | | :  '- \'.;'\ _ /';.'/ - ' : | |
                |  | '_.   \_ __\ /__ _/   .-' |  |
            ====='-.____'.___ \_____/___.-'___.-'=====
                              '=---='
            ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
      
                          佛祖保佑，永無 BUG
                          薪水增多，財富自由
        `)
      }

      function unregister() {
          if ('serviceWorker' in navigator) {
              navigator.serviceWorker.getRegistrations().then(function(registrations) {
                  for (let registration of registrations) {
                      registration.unregister();
                  }
              });
          }
      }

      unregister();
    }, 5000)
    
  }
</script>
  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="是 Ray 不是 Array" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切換導航欄" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">是 Ray 不是 Array</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Welcome.Web.World <br/> 歡迎來到網路世界</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜尋" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首頁</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>標籤</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分類</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>歸檔</a></li><li class="menu-item menu-item-rss"><a href="/atom.xml" rel="section"><i class="fa fa-rss fa-fw"></i>RSS</a></li><li class="menu-item menu-item-更多"><a href="/links/" rel="section"><i class="fa fa-link fa-fw"></i>更多</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜尋
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container"></div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container">
  <div class="algolia-stats"><hr></div>
  <div class="algolia-hits"></div>
  <div class="algolia-pagination"></div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目錄
        </li>
        <li class="sidebar-nav-overview">
          本站概要
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8B%E5%89%8D%E6%BA%96%E5%82%99"><span class="nav-number">2.</span> <span class="nav-text">事前準備</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Nodemailer"><span class="nav-number">3.</span> <span class="nav-text">Nodemailer</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-OAuth-2-0-%E5%AF%84%E4%BF%A1"><span class="nav-number">4.</span> <span class="nav-text">使用 OAuth 2.0 寄信</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BB%BA%E7%AB%8B%E5%B0%88%E6%A1%88"><span class="nav-number">4.1.</span> <span class="nav-text">建立專案</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%95%9F%E7%94%A8-API-%E5%92%8C%E6%9C%8D%E5%8B%99"><span class="nav-number">4.2.</span> <span class="nav-text">啟用 API 和服務</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A8%AD%E5%AE%9A-OAuth-%E5%90%8C%E6%84%8F%E7%95%AB%E9%9D%A2"><span class="nav-number">4.3.</span> <span class="nav-text">設定 OAuth 同意畫面</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BB%BA%E7%AB%8B%E6%86%91%E8%AD%89"><span class="nav-number">4.4.</span> <span class="nav-text">建立憑證</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%92%B0%E5%AF%AB-Gmail-OAuth-%E7%A8%8B%E5%BC%8F%E7%A2%BC"><span class="nav-number">4.5.</span> <span class="nav-text">撰寫 Gmail OAuth  程式碼</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BB%BA%E7%AB%8B-Env"><span class="nav-number">4.6.</span> <span class="nav-text">建立 Env</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BB%BA%E7%AB%8B-Google-OAuth2-Client"><span class="nav-number">4.7.</span> <span class="nav-text">建立 Google OAuth2 Client</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BB%BA%E7%AB%8B-Google-OAuth2-URL"><span class="nav-number">4.8.</span> <span class="nav-text">建立 Google OAuth2 URL</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BB%BA%E7%AB%8B-Nodemailer-OAuth2"><span class="nav-number">4.9.</span> <span class="nav-text">建立 Nodemailer OAuth2</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E5%B8%B3%E8%99%9F%E5%AF%86%E7%A2%BC%EF%BC%88%E6%87%89%E7%94%A8%E7%A8%8B%E5%BC%8F%E5%AF%86%E7%A2%BC%EF%BC%89%E4%BE%86%E7%99%BC%E9%80%81-Email"><span class="nav-number">5.</span> <span class="nav-text">使用帳號密碼（應用程式密碼）來發送 Email</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%92%B0%E5%AF%AB-Env"><span class="nav-number">5.1.</span> <span class="nav-text">撰寫 Env</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%95%9F%E7%94%A8-Google-%E8%A8%AD%E5%AE%9A"><span class="nav-number">5.2.</span> <span class="nav-text">啟用 Google 設定</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%92%B0%E5%AF%AB%E7%A8%8B%E5%BC%8F%E7%A2%BC"><span class="nav-number">5.3.</span> <span class="nav-text">撰寫程式碼</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%8C%E6%95%B4%E7%AF%84%E4%BE%8B%E7%A8%8B%E5%BC%8F%E7%A2%BC"><span class="nav-number">6.</span> <span class="nav-text">完整範例程式碼</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%B5%90%E8%AA%9E"><span class="nav-number">7.</span> <span class="nav-text">結語</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Ray"
      src="/images/octocat.jpg">
  <p class="site-author-name" itemprop="name">Ray</p>
  <div class="site-description" itemprop="description">👨‍💻F2E-Front End Engineer <br/> 歡迎來到網頁世界</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">975</span>
          <span class="site-state-item-name">文章</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">36</span>
        <span class="site-state-item-name">分類</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">830</span>
        <span class="site-state-item-name">標籤</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://www.buymeacoffee.com/israynotarray" title="BuyCoffee → https:&#x2F;&#x2F;www.buymeacoffee.com&#x2F;israynotarray" rel="noopener me" target="_blank"><i class="fa-solid fa-money-bill fa-fw"></i>BuyCoffee</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://portaly.cc/israynotarray" title="Portaly → https:&#x2F;&#x2F;portaly.cc&#x2F;israynotarray" rel="noopener me" target="_blank"><i class="fas fa-link fa-fw"></i>Portaly</a>
      </span>
  </div>
<div style="color: var(--text-color); width: 100%;">
  

<div style="color: var(--text-color); width: 100%;">
  <div>
    <h4>
      <i class="fab fa-google"></i>
      Google AD
    </h4>
  </div>
  <div
    style="height: 300px; border: 5px var(--text-color) dashed;">
    <div class="message-block">
      <p style="color: var(--text-color); font-size: 0.75rem;margin: 0;">
        撰寫一篇文章其實真的很花時間，如果你願意<strong>「關閉 Adblock (廣告阻擋器)」</strong>來支持我的話，我會非常感謝你 ヽ(・∀・)ﾉ
      </p>
    </div>
    <!-- hsiangfeng_slider -->
    <ins class="adsbygoogle"
        style="display:block"
        data-ad-client="ca-pub-4319471747130190"
        data-ad-slot="8042789820"
        data-ad-format="auto"
        data-full-width-responsive="true"></ins>
    <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
  </div>
</div>
        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-TW">
    <link itemprop="mainEntityOfPage" href="https://israynotarray.com/nodejs/20230722/1626712457/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/octocat.jpg">
      <meta itemprop="name" content="Ray">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="是 Ray 不是 Array">
      <meta itemprop="description" content="👨‍💻F2E-Front End Engineer <br/> 歡迎來到網頁世界">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Node.js 應用篇 - 使用 Nodemailer 來發送 Email | 是 Ray 不是 Array">
      <meta itemprop="description" content="這一篇我將會記錄一下如何用 Nodemailer 來發送 Email，而這一篇將會記錄使用 Gmail 以及 OAuth2 跟帳號密碼（應用程式密碼）的兩種方式來發送 Email。">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Node.js 應用篇 - 使用 Nodemailer 來發送 Email
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">發表於</span>

      <time title="創建時間：2023-07-22 09:56:44" itemprop="dateCreated datePublished" datetime="2023-07-22T09:56:44+08:00">2023-07-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新於</span>
      <time title="修改時間：2023-10-20 14:45:00" itemprop="dateModified" datetime="2023-10-20T14:45:00+08:00">2023-10-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分類於</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/nodejs/" itemprop="url" rel="index"><span itemprop="name">Nodejs</span></a>
        </span>
    </span>

  

<div style="color: var(--text-color); width: 100%;">
  <div>
    <h4>
      <i class="fab fa-google"></i>
      Google AD
    </h4>
  </div>
  <div
    style="height: 90px; width: 100%; border: 5px var(--text-color) dashed;">
    <div class="message-block">
      <p style="color: var(--text-color); font-size: 0.75rem;margin: 0;">
        撰寫一篇文章其實真的很花時間，如果你願意<strong>「關閉 Adblock (廣告阻擋器)」</strong>來支持我的話，我會非常感謝你 ヽ(・∀・)ﾉ
      </p>
    </div>
    <!-- hsiangfeng_postheader -->
    <ins
      class="adsbygoogle"
      style="display:block; height: 90px; width: 100%;font-size: 1rem;"
      data-ad-client="ca-pub-4319471747130190"
      data-ad-slot="2208469553"
      data-ad-format="auto"
      data-full-width-responsive="true">
    </ins>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
  </div>
</div>
<div style="color: var(--text-color); width: 100%;">
  <h4>
    <i class="fas fa-heart"></i>
    請我喝一杯咖啡
  </h4>
  <div style="border: 5px var(--text-color) dashed;padding: 20px;font-size: 14px;">
    這篇筆記文章如果對你有幫助，
    <br />
    你可以也可以請我「喝一杯咖啡(Donate)」。
    <br /><br />
    <div style="display: flex;justify-content: center;align-items: center;">
      <a href="https://www.buymeacoffee.com/israynotarray" target="_blank" style="text-decoration: none !important;border: 0px !important;">
        <img src="https://cdn.buymeacoffee.com/buttons/v2/default-yellow.png" alt="Buy Me A Coffee" style="height: 60px !important;width: 217px !important;" >
      </a>
      ｜
      <a href="https://portaly.cc/israynotarray/support" target="_blank" style="text-decoration: none !important;border: 0px !important;">
        <img src="/images/logo.b91a6dbf.webp" alt="Buy Me A Coffee" style="height: 50px !important;background: #fff !important;border-radius: 5px !important;padding: 10px !important;" >
      </a>
    </div>
  </div>
</div>


</div>

            <div class="post-description">這一篇我將會記錄一下如何用 Nodemailer 來發送 Email，而這一篇將會記錄使用 Gmail 以及 OAuth2 跟帳號密碼（應用程式密碼）的兩種方式來發送 Email。</div>
        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><!-- markdownlint-disable MD033 -->

<p><img src="https://firebasestorage.googleapis.com/v0/b/israynotarray2.appspot.com/o/blog2%2Fnodejs%2Fnodemailer-google-email%2F0_1.png?alt=media&token=5ceef9cb-0c31-44ed-8cdd-b302aa191a77" alt="Web"></p>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>這一篇我將會記錄一下如何用 Nodemailer 來發送 Email，而這一篇將會記錄使用 Gmail 以及 OAuth2 跟帳號密碼（應用程式密碼）的兩種方式來發送 Email。</p>
<h2 id="事前準備"><a href="#事前準備" class="headerlink" title="事前準備"></a>事前準備</h2><p>首先這邊我會先提供事前的準備環境，你可以透過以下連結取用</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/hsiangfeng/node-nodemailer-init">node-nodemailer-init</a></li>
</ul>
<p>這個環境相對單純一點，我只有安裝 <code>nodemailer</code>、<code>googleapis</code>、<code>dotenv</code> 套件，其餘都是 Express 產生器的東西。</p>
<p>如果你不想使用這個初始範本，你可以自己建立一個 Express 專案，然後安裝 <code>nodemailer</code>、<code>googleapis</code>、<code>dotenv</code> 套件即可。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install nodemailer googleapis dotenv</span><br></pre></td></tr></table></figure>

<h2 id="Nodemailer"><a href="#Nodemailer" class="headerlink" title="Nodemailer"></a>Nodemailer</h2><p>雖然早期我有寫過關於 <a href="/nodejs/20191228/1009061739/">全端勇士之路 Node.js-OAuth 2.0 &amp; nodemailer &amp; Gmail</a>，但我認為這一篇有點過於老舊，所以我決定重新寫一篇。</p>
<p>那麼 Nodemailer 是什麼神奇的東西呢？簡單來講它是一個 Node.js 的套件，可以讓我們在 Node.js 環境下發送 Email，而這個功能對於一個網站來說是非常重要的，因為我們可以透過 Email 來發送驗證碼、通知信、訂閱信等等，所以在實戰上可以說是非常常見的。</p>
<p>以官方文件來講底下就有提供一個算是滿完整的 Example：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&quot;use strict&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> nodemailer = <span class="built_in">require</span>(<span class="string">&quot;nodemailer&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> transporter = nodemailer.<span class="title function_">createTransport</span>(&#123;</span><br><span class="line">  <span class="attr">host</span>: <span class="string">&quot;smtp.forwardemail.net&quot;</span>,</span><br><span class="line">  <span class="attr">port</span>: <span class="number">465</span>,</span><br><span class="line">  <span class="attr">secure</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">auth</span>: &#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> replace `user` and `pass` values from &lt;https://forwardemail.net&gt;</span></span><br><span class="line">    <span class="attr">user</span>: <span class="string">&#x27;REPLACE-WITH-YOUR-ALIAS@YOURDOMAIN.COM&#x27;</span>,</span><br><span class="line">    <span class="attr">pass</span>: <span class="string">&#x27;REPLACE-WITH-YOUR-GENERATED-PASSWORD&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// async..await is not allowed in global scope, must use a wrapper</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">main</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// send mail with defined transport object</span></span><br><span class="line">  <span class="keyword">const</span> info = <span class="keyword">await</span> transporter.<span class="title function_">sendMail</span>(&#123;</span><br><span class="line">    <span class="attr">from</span>: <span class="string">&#x27;&quot;Fred Foo 👻&quot; &lt;foo@example.com&gt;&#x27;</span>, <span class="comment">// sender address</span></span><br><span class="line">    <span class="attr">to</span>: <span class="string">&quot;bar@example.com, baz@example.com&quot;</span>, <span class="comment">// list of receivers</span></span><br><span class="line">    <span class="attr">subject</span>: <span class="string">&quot;Hello ✔&quot;</span>, <span class="comment">// Subject line</span></span><br><span class="line">    <span class="attr">text</span>: <span class="string">&quot;Hello world?&quot;</span>, <span class="comment">// plain text body</span></span><br><span class="line">    <span class="attr">html</span>: <span class="string">&quot;&lt;b&gt;Hello world?&lt;/b&gt;&quot;</span>, <span class="comment">// html body</span></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Message sent: %s&quot;</span>, info.<span class="property">messageId</span>);</span><br><span class="line">  <span class="comment">// Message sent: &lt;b658f8ca-6296-ccf4-8306-87d57a0b4321@example.com&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  <span class="comment">// <span class="doctag">NOTE:</span> You can go to https://forwardemail.net/my-account/emails to see your email delivery status and preview</span></span><br><span class="line">  <span class="comment">//       Or you can use the &quot;preview-email&quot; npm package to preview emails locally in browsers and iOS Simulator</span></span><br><span class="line">  <span class="comment">//       &lt;https://github.com/forwardemail/preview-email&gt;</span></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">main</span>().<span class="title function_">catch</span>(<span class="variable language_">console</span>.<span class="property">error</span>);</span><br></pre></td></tr></table></figure>

<p>但是今天我們的目標是要使用 Gmail 來發送 Email，並且是搭配 OAuth2 的方式來發送，所以我們就來看看怎麼做吧。</p>
<p>所以我們必須要先了解 Gmail 的限制，那麼有哪些限制呢？這邊我就只列出比較需要注意的限制：</p>
<ul>
<li>每日發送限制：500 封</li>
<li>單一電子郵件收件者超過 500 封</li>
<li>每封電子郵件大小上限：25 MB</li>
</ul>
<p>其他部分舉凡…濫發垃圾郵件、濫發廣告郵件、濫發病毒郵件等等，都是不被允許的，如果被 Google 發現，你的帳號可能會被鎖定，所以請務必注意哩。</p>
<h2 id="使用-OAuth-2-0-寄信"><a href="#使用-OAuth-2-0-寄信" class="headerlink" title="使用 OAuth 2.0 寄信"></a>使用 OAuth 2.0 寄信</h2><p>早期許多 Nodemailer 文章教學都是介紹使用帳號密碼的方式來介紹，但是後來 Google 開始限制使用這種方式，因為使用傳統帳號密碼來發送信件的方式並不是很安全，所以 Google 開始推出 OAuth2 的方式來取代傳統帳號密碼的方式，但這種方式其實比較複雜，因為你必須要先取得授權，所以前面一開始我也會先介紹比較複雜的部分。</p>
<h3 id="建立專案"><a href="#建立專案" class="headerlink" title="建立專案"></a>建立專案</h3><p>首先這邊我們要先到 「<a target="_blank" rel="noopener" href="https://console.cloud.google.com/">Google Cloud Platform</a>」建立一個新專案，當然你也可以使用舊專案，但是我建議你還是建立一個新專案，因為這樣比較不會搞混。</p>
<p><img src="https://firebasestorage.googleapis.com/v0/b/israynotarray2.appspot.com/o/blog2%2Fnodejs%2Fnodemailer-google-email%2F202307211027.jpg?alt=media&token=001723af-ec44-43e9-8891-83ab76339577" alt="建立專案"></p>
<p>專案名稱你可以自己取，這邊我取名為「nodemailer-example」</p>
<p><img src="https://firebasestorage.googleapis.com/v0/b/israynotarray2.appspot.com/o/blog2%2Fnodejs%2Fnodemailer-google-email%2F2023-07-21%2010.29.36.png?alt=media&token=c057f2c8-ce9a-487c-b8c3-646ca09f0900" alt="新增專案"></p>
<p>建立過程中稍微等它一下下…</p>
<p><img src="https://firebasestorage.googleapis.com/v0/b/israynotarray2.appspot.com/o/blog2%2Fnodejs%2Fnodemailer-google-email%2F2023-07-21%2010.32.12.png?alt=media&token=6320dc13-4b2c-49ce-83af-893286d19349" alt="建立中..."></p>
<p>建立成功後，你可以在通知或是剛剛選取專案的地方找到剛剛建立的專案，然後點選進去</p>
<p><img src="https://firebasestorage.googleapis.com/v0/b/israynotarray2.appspot.com/o/blog2%2Fnodejs%2Fnodemailer-google-email%2F2023-07-21%2010.32.52.png?alt=media&token=4bb66e97-b044-49d9-aec6-387543e41692" alt="專案"></p>
<p><img src="https://firebasestorage.googleapis.com/v0/b/israynotarray2.appspot.com/o/blog2%2Fnodejs%2Fnodemailer-google-email%2F2023-07-21%2010.32.57.png?alt=media&token=56b2fdce-c60e-422c-8a19-80d27b62923f" alt="專案"></p>
<h3 id="啟用-API-和服務"><a href="#啟用-API-和服務" class="headerlink" title="啟用 API 和服務"></a>啟用 API 和服務</h3><p>接著請你點一下左邊漢堡選單，然後點選「已啟用的 API 和服務」</p>
<p><img src="https://firebasestorage.googleapis.com/v0/b/israynotarray2.appspot.com/o/blog2%2Fnodejs%2Fnodemailer-google-email%2F202307211035.jpg?alt=media&token=cc93b9b8-bdca-443e-b72c-6fc633010a68" alt="已啟用的 API 和服務"></p>
<p>接著點一下上方「啟用 API 和服務」</p>
<p><img src="https://firebasestorage.googleapis.com/v0/b/israynotarray2.appspot.com/o/blog2%2Fnodejs%2Fnodemailer-google-email%2F202307211102.jpg?alt=media&token=950d63e4-21d1-47ee-bcbe-6c2efd02893c" alt="啟用 API 和服務"></p>
<p>接著搜尋「Gmail API」，然後點選「Gmail API」</p>
<p><img src="https://firebasestorage.googleapis.com/v0/b/israynotarray2.appspot.com/o/blog2%2Fnodejs%2Fnodemailer-google-email%2F202307211103.jpg?alt=media&token=86cae0d7-9a59-4808-bdde-59dcb6d0abf1" alt="Gmail API"></p>
<p>接著點一下「啟用」</p>
<p><img src="https://firebasestorage.googleapis.com/v0/b/israynotarray2.appspot.com/o/blog2%2Fnodejs%2Fnodemailer-google-email%2F202307211105.jpg?alt=media&token=3bc21c43-029e-41a1-9871-344d04f035a9" alt="Gmail API"></p>
<h3 id="設定-OAuth-同意畫面"><a href="#設定-OAuth-同意畫面" class="headerlink" title="設定 OAuth 同意畫面"></a>設定 OAuth 同意畫面</h3><p>接著回到「API 和服務」，然後點選「憑證」</p>
<p><img src="https://firebasestorage.googleapis.com/v0/b/israynotarray2.appspot.com/o/blog2%2Fnodejs%2Fnodemailer-google-email%2F202307211111.jpg?alt=media&token=adff4903-03c7-4d15-af48-3c3722311d97" alt="憑證"></p>
<p>要「建立憑證」之前，如果你跟我一樣是第一次設定的話，你會看到一個提示，提示你要先設定 OAuth 同意畫面，所以請你點選「設定同意畫面」</p>
<p><img src="https://firebasestorage.googleapis.com/v0/b/israynotarray2.appspot.com/o/blog2%2Fnodejs%2Fnodemailer-google-email%2F202307211115.jpg?alt=media&token=bd347292-b2e3-4742-ad32-f5d79f420a97" alt="設定同意畫面"></p>
<p>接著請你選擇「外部」，然後點選「建立」</p>
<p><img src="https://firebasestorage.googleapis.com/v0/b/israynotarray2.appspot.com/o/blog2%2Fnodejs%2Fnodemailer-google-email%2F2023-07-21%2011.18.55.png?alt=media&token=bba222db-5ba3-4430-a62b-83be313dbc80" alt="同意畫面"></p>
<p>接下來會進入「編輯應用程式註冊申請」畫面，這邊要填寫一些資料，除了底下這幾個欄位是必填的，其餘都是選填的：</p>
<ul>
<li>應用程式名稱：你可以自己取名，這邊我取名為「nodemailer-example」</li>
<li>使用者支援電子郵件：選你自己 Email</li>
<li>開發人員聯絡資訊：填寫你自己 Email</li>
</ul>
<p>如果不確定，你可以依照我圖片這樣填寫就好</p>
<p><img src="https://firebasestorage.googleapis.com/v0/b/israynotarray2.appspot.com/o/blog2%2Fnodejs%2Fnodemailer-google-email%2F202307211128.jpg?alt=media&token=1d9d9299-1844-4066-8cdd-ad38620e2ada" alt="編輯應用程式註冊申請"></p>
<p>接下來會到達「範圍」的設定頁面，這邊直接繼續就好</p>
<p><img src="https://firebasestorage.googleapis.com/v0/b/israynotarray2.appspot.com/o/blog2%2Fnodejs%2Fnodemailer-google-email%2F2023-07-21%2011.32.39.png?alt=media&token=a732d607-c93c-416d-8eaa-b88cae83c51f" alt="範圍"></p>
<p>接下來要設定「測試使用者」，基本上如果你這個應用程式發布狀態是「測試中」的話，你就必須設定一些可以使用這個應用程式的測試使用者，這邊你可以點一下 「Add Users」並輸入自己 Google 帳號，如果是正式環境的話則不用，那我這邊就先不設定直接點選「儲存並繼續」。</p>
<p>基本上你到達「摘要」時，就完成了「OAuth 同意畫面」的設定囉</p>
<p><img src="https://firebasestorage.googleapis.com/v0/b/israynotarray2.appspot.com/o/blog2%2Fnodejs%2Fnodemailer-google-email%2F2023-07-21%2011.37.52.png?alt=media&token=8cd3a3f6-419d-4e92-b678-6caea0c5c5ab" alt="摘要"></p>
<h3 id="建立憑證"><a href="#建立憑證" class="headerlink" title="建立憑證"></a>建立憑證</h3><p>接下來你就可以回到「憑證」的頁面，然後點選「建立憑證」，接著點選「OAuth 用戶端 ID」</p>
<p><img src="https://firebasestorage.googleapis.com/v0/b/welcomewebworld-4097b.appspot.com/o/blogImg%2FNodejs%2F202104060914.png?alt=media&token=39874960-e1b7-4a72-8be3-78228cfda98f" alt="OAuth 用戶端 ID"></p>
<p>接著在應用程式類型欄位選擇「網路應用程式」，然後輸入以下欄位：</p>
<ul>
<li>名稱：你可以自己取名，這邊我取名為「nodemailer-example-web」</li>
<li>已授權的重新導向 URI：請輸入 <code>http://localhost:3000/auth/google/callback</code></li>
</ul>
<p><img src="https://firebasestorage.googleapis.com/v0/b/israynotarray2.appspot.com/o/blog2%2Fnodejs%2Fnodemailer-google-email%2F202307211438.jpg?alt=media&token=16303604-deea-4ea7-a391-3cba0399b30c" alt="憑證"></p>
<blockquote>
<p><strong>Note</strong><br>在我先前的文章中，我有提到過這個欄位要填寫「<a target="_blank" rel="noopener" href="https://developers.google.com/oauthplayground/">https://developers.google.com/oauthplayground/</a>」的網址，但這邊我們要換另一種方式。</p>
</blockquote>
<p>接下來按下「建立」後就可以取得 Client ID 與 Client Secret，這兩個請不要外流，因為這兩個是用來驗證你的身份的，如果被人拿去亂用，你的帳號可能會被 Google 鎖定（你也可以直接下載 JSON 檔案，裡面就有這兩個資訊）</p>
<p>到這邊為止，我們的 Gmail OAuth 相關前置動作就終於準備好了，接下來就可以開始撰寫程式碼囉～</p>
<h3 id="撰寫-Gmail-OAuth-程式碼"><a href="#撰寫-Gmail-OAuth-程式碼" class="headerlink" title="撰寫 Gmail OAuth  程式碼"></a>撰寫 Gmail OAuth  程式碼</h3><p>那麼前面我已經有先提供基本的環境，所以我們就可以直接開始撰寫程式碼了。</p>
<blockquote>
<p><strong>Note</strong><br>請務必確定你的專案內有無安裝 <code>nodemailer</code>、<code>googleapis</code>、<code>dotenv</code> 這幾個套件，否則稍後可能會出現錯誤無法往下練習。</p>
</blockquote>
<h3 id="建立-Env"><a href="#建立-Env" class="headerlink" title="建立 Env"></a>建立 Env</h3><p>首先這邊請你在專案底下建立一個 .env 檔案，內容如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CLIENT_ID=你的 Client ID</span><br><span class="line">CLIENT_SECRET=你的 Client Secret</span><br><span class="line">REDIRECT_URI=http://localhost:3000/auth/google/callback</span><br></pre></td></tr></table></figure>

<p>這幾個資訊都可以在剛剛建立憑證時取得，如果你有下載 JSON 檔案的話，你可以直接打開 JSON 檔案，裡面就有這些資訊</p>
<p><img src="https://firebasestorage.googleapis.com/v0/b/israynotarray2.appspot.com/o/blog2%2Fnodejs%2Fnodemailer-google-email%2F202307211456.jpg?alt=media&token=0fd01b91-2e07-4f2b-8ba9-6c871435a753" alt="JSON"></p>
<h3 id="建立-Google-OAuth2-Client"><a href="#建立-Google-OAuth2-Client" class="headerlink" title="建立 Google OAuth2 Client"></a>建立 Google OAuth2 Client</h3><p>接下來請你在根目錄下建立一個資料夾，名稱為 <code>config</code>，然後在裡面建立一個檔案，名稱為 <code>googleOAuth2Client.js</code>，內容如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;dotenv&#x27;</span>).<span class="title function_">config</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; google &#125; = <span class="built_in">require</span>(<span class="string">&#x27;googleapis&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> googleOAuth2Client = <span class="keyword">new</span> google.<span class="property">auth</span>.<span class="title class_">OAuth2</span>(</span><br><span class="line">  process.<span class="property">env</span>.<span class="property">CLIENT_ID</span>,</span><br><span class="line">  process.<span class="property">env</span>.<span class="property">CLIENT_SECRET</span>,</span><br><span class="line">  process.<span class="property">env</span>.<span class="property">REDIRECT_URI</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = googleOAuth2Client;</span><br></pre></td></tr></table></figure>

<p>這邊我們使用 <code>googleapis</code> 套件來建立 Google OAuth2 Client，這邊我們使用 <code>google.auth.OAuth2</code> 來建立，並且傳入三個參數：</p>
<ul>
<li>CLIENT_ID：你的 Client ID</li>
<li>CLIENT_SECRET：你的 Client Secret</li>
<li>REDIRECT_URI：你的 Redirect URI</li>
</ul>
<h3 id="建立-Google-OAuth2-URL"><a href="#建立-Google-OAuth2-URL" class="headerlink" title="建立 Google OAuth2 URL"></a>建立 Google OAuth2 URL</h3><p>接下來請你在根目錄下建立一個資料夾，名稱為 <code>routes</code>，然後在裡面建立一個檔案，名稱為 <code>auth.js</code>，內容如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> router = express.<span class="title class_">Router</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> googleOAuth2Client = <span class="built_in">require</span>(<span class="string">&#x27;../config/googleOAuth2Client&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">SCOPES</span> = [</span><br><span class="line">  <span class="string">&#x27;https://mail.google.com/&#x27;</span>,</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/login&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> authUrl = googleOAuth2Client.<span class="title function_">generateAuthUrl</span>(&#123;</span><br><span class="line">    <span class="attr">access_type</span>: <span class="string">&#x27;offline&#x27;</span>,</span><br><span class="line">    <span class="attr">scope</span>: <span class="variable constant_">SCOPES</span>,</span><br><span class="line">  &#125;);</span><br><span class="line">  res.<span class="title function_">redirect</span>(authUrl);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/google/callback&#x27;</span>, <span class="keyword">async</span> (req, res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> code = req.<span class="property">query</span>.<span class="property">code</span>;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; tokens &#125; = <span class="keyword">await</span> googleOAuth2Client.<span class="title function_">getToken</span>(code)</span><br><span class="line"></span><br><span class="line">    googleOAuth2Client.<span class="title function_">setCredentials</span>(tokens);</span><br><span class="line">    req.<span class="property">session</span>.<span class="property">tokens</span> = tokens;</span><br><span class="line"></span><br><span class="line">    res.<span class="title function_">redirect</span>(<span class="string">&#x27;/email/user&#x27;</span>);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;Error authenticating with Google:&#x27;</span>, err);</span><br><span class="line">    res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">send</span>(<span class="string">&#x27;Error authenticating with Google&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router;</span><br></pre></td></tr></table></figure>

<p>接著到 app.js 加入以下</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> authRouter = <span class="built_in">require</span>(<span class="string">&#x27;./routes/auth&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ... 略過大量程式碼</span></span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&#x27;/auth&#x27;</span>, authRouter);</span><br></pre></td></tr></table></figure>

<p>接下來你就可以透過網址 <code>http://localhost:3000/auth/login</code> 來取得 Google OAuth2 URL，這時候你會被導向到 Google 登入頁面</p>
<p><img src="https://firebasestorage.googleapis.com/v0/b/israynotarray2.appspot.com/o/blog2%2Fnodejs%2Fnodemailer-google-email%2F202307212044.jpg?alt=media&token=dff238b0-9224-4003-ba3b-dbffbb1f7c15" alt="Google 登入頁面"></p>
<p>點選你要登入的帳號，接下來會出現一個警告畫面，這邊不用太擔心畢竟是你的應用程式，只需要點開「進階」，然後點選「前往 nodemailer-example（不安全）」即可</p>
<p><img src="https://firebasestorage.googleapis.com/v0/b/israynotarray2.appspot.com/o/blog2%2Fnodejs%2Fnodemailer-google-email%2F202307212040.jpg?alt=media&token=d20075c2-40ff-4558-849a-71d5c1c8524e" alt="不安全的應用程式"></p>
<p>接下來這邊按下「允許」</p>
<p><img src="https://firebasestorage.googleapis.com/v0/b/israynotarray2.appspot.com/o/blog2%2Fnodejs%2Fnodemailer-google-email%2F202307212041.jpg?alt=media&token=498575c3-3756-4cc7-b978-977466d75133" alt="允許"></p>
<p>完成後就會重新導向回 <code>http://localhost:3000/auth/google/callback</code> 這個網址，並且取得 <code>code</code>，這個 <code>code</code> 就是用來取得 <code>tokens</code> 的，而 <code>tokens</code> 就是用來驗證你的身份的。</p>
<p>而這邊我們也將 <code>tokens</code> 儲存在 <code>session</code> 中，這樣我們就可以在後續的程式碼中使用 <code>tokens</code> 來驗證身份。</p>
<p>但是這邊你應該會發生一個錯，也就是以下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Error authenticating with Google: TypeError: Cannot <span class="built_in">set</span> properties of undefined (setting <span class="string">&#x27;tokens&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>這個原因是預設 Express 產生器並沒有啟用 <code>session</code> 功能，所以我們必須要自己啟用 <code>session</code> 功能，這邊我們使用 <code>express-session</code> 來啟用 <code>session</code> 功能，所以請你在根目錄下執行以下指令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install express-session</span><br></pre></td></tr></table></figure>

<p>接著到 app.js 加入以下</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> session = <span class="built_in">require</span>(<span class="string">&#x27;express-session&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ... 略過大量程式碼</span></span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">session</span>(&#123;</span><br><span class="line">  <span class="attr">secret</span>: <span class="string">&#x27;keyboard cat&#x27;</span>,</span><br><span class="line">  <span class="attr">resave</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">saveUninitialized</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">cookie</span>: &#123; <span class="attr">secure</span>: <span class="literal">false</span> &#125;</span><br><span class="line">&#125;))</span><br></pre></td></tr></table></figure>

<p>這樣你才不會發生「<code>TypeError: Cannot set properties of undefined</code>」的錯誤唷。</p>
<blockquote>
<p><strong>Note</strong><br><code>express-session</code> 有一個小雷點要注意一下，官方所提供的範例 <code>secure</code> 屬性是 <code>true</code>，這就代表著你本地開發時，你的 session 會沒有辦法儲存下來，只要一換頁面就會被清除，所以這邊我將 <code>secure</code> 屬性改為 <code>false</code>，這樣你就可以在本地開發時使用 <code>session</code> 功能了。</p>
</blockquote>
<h3 id="建立-Nodemailer-OAuth2"><a href="#建立-Nodemailer-OAuth2" class="headerlink" title="建立 Nodemailer OAuth2"></a>建立 Nodemailer OAuth2</h3><p>接下來請你到 <code>routes</code> 資料夾的 <code>index.js</code>，我們要在這邊建立 Nodemailer，內容如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/user/send&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123;</span><br><span class="line">    refresh_token,</span><br><span class="line">    access_token,</span><br><span class="line">  &#125; = req.<span class="property">session</span>.<span class="property">tokens</span>;</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> transporter = nodemailer.<span class="title function_">createTransport</span>(&#123;</span><br><span class="line">    <span class="attr">service</span>: <span class="string">&#x27;gmail&#x27;</span>,</span><br><span class="line">    <span class="attr">auth</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;OAuth2&#x27;</span>,</span><br><span class="line">      <span class="attr">user</span>: <span class="string">&#x27;你要用來發送信件的 Gmail&#x27;</span>,</span><br><span class="line">      <span class="attr">clientId</span>: process.<span class="property">env</span>.<span class="property">CLIENT_ID</span>,</span><br><span class="line">      <span class="attr">clientSecret</span>: process.<span class="property">env</span>.<span class="property">CLIENT_SECRET</span>,</span><br><span class="line">      <span class="attr">refreshToken</span>: refresh_token,</span><br><span class="line">      <span class="attr">accessToken</span>: access_token,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> mailOptions = &#123;</span><br><span class="line">    <span class="attr">from</span>: <span class="string">&#x27;你要用來發送信件的 Gmail&#x27;</span>,</span><br><span class="line">    <span class="attr">to</span>: <span class="string">&#x27;你要發送的對象&#x27;</span>,</span><br><span class="line">    <span class="attr">subject</span>: <span class="string">&#x27;這是信件的主旨&#x27;</span>,</span><br><span class="line">    <span class="attr">text</span>: <span class="string">&#x27;‘這是信件的內容&#x27;</span>,</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  transporter.<span class="title function_">sendMail</span>(mailOptions, <span class="function">(<span class="params">err, info</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">error</span>(err);</span><br><span class="line">      res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">send</span>(<span class="string">&#x27;Error sending email&#x27;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(info);</span><br><span class="line">      res.<span class="title function_">send</span>(<span class="string">&#x27;Email sent&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router;</span><br></pre></td></tr></table></figure>

<p>基本上到這邊為止，你就完成了 Nodemailer 的設定，接下來你可以透過網頁來發送出信件囉~</p>
<h2 id="使用帳號密碼（應用程式密碼）來發送-Email"><a href="#使用帳號密碼（應用程式密碼）來發送-Email" class="headerlink" title="使用帳號密碼（應用程式密碼）來發送 Email"></a>使用帳號密碼（應用程式密碼）來發送 Email</h2><p>接下來我想介紹另一種方式發送信箱，為什麼呢？</p>
<p>因為前面的做法是使用了 OAuth 的方式來發送信件，那麼使用 OAuth 的問題在於，如果我今天登入的使用者不是 A 而是 B 的話，那麼就無法寄出，因為我們使用的 Token 與 Refresh Token 都是 A 的，所以這邊我想介紹另一種方式，那就是使用帳號密碼直接寫死並登入，這樣就不會有上述的問題了。</p>
<p>那麼這邊有些人應該有嘗試過使用帳號密碼方式寄送 Gmail，應該大多都有遇過以下錯誤訊息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Error: Invalid login: 535-5.7.8 Username and Password not accepted. Learn more at 535 5.7.8  https://support.google.com/mail/?p=BadCredentials k17-20020aa78211000000b00682562bf477sm3695625pfi.82 - gsmtp</span><br></pre></td></tr></table></figure>

<p>這個錯誤訊息是因為 Google 開始限制使用帳號密碼的方式來寄送信件，早期我們可以到 Google 設定中開啟「低安全性應用程式存取權」，這樣就可以使用帳號密碼的方式來寄送信件，但是後來 Google 也開始限制這個功能，所以我們就無法使用這個方式來寄送信件了。</p>
<p>所以這邊我要教另一種方式哩~</p>
<h3 id="撰寫-Env"><a href="#撰寫-Env" class="headerlink" title="撰寫 Env"></a>撰寫 Env</h3><p>接下來請你在原本的 <code>.env</code> 補充以下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GMAIL_USER=你要用來發送信件的 Gmail</span><br><span class="line">GMAIL_PASS=你要用來發送信件的 Gmail 密碼</span><br></pre></td></tr></table></figure>

<p>接下來準備來也是要去設定一下 Google 的部分，但不會像剛剛那樣複雜。</p>
<h3 id="啟用-Google-設定"><a href="#啟用-Google-設定" class="headerlink" title="啟用 Google 設定"></a>啟用 Google 設定</h3><p>首先請你到 Google 設定中心，然後點選「安全性」</p>
<p><img src="https://firebasestorage.googleapis.com/v0/b/israynotarray2.appspot.com/o/blog2%2Fnodejs%2Fnodemailer-google-email%2F2023-07-22%2012.19.15.png?alt=media&token=5d31780f-8cc3-4c01-b09c-a6514424b8ee" alt="安全性"></p>
<p>如果你沒有啟用二次驗證的話，這邊會建議你啟用後再繼續，避免你無法往後操作唷</p>
<p><img src="https://firebasestorage.googleapis.com/v0/b/israynotarray2.appspot.com/o/blog2%2Fnodejs%2Fnodemailer-google-email%2F2023-07-22%2012.43.25.png?alt=media&token=ae991a9b-64c4-437e-976d-f0d1da32e98b" alt="二次驗證"></p>
<blockquote>
<p><strong>Note</strong><br>後來我建立新帳號實測，Google 是強制你一定要開啟二次驗證的唷。</p>
</blockquote>
<p>如果你本身已經有啟用的話，那麼你就可以點一下兩步驟驗證，然後輸入密碼後滾到最下方找到「應用程式密碼」</p>
<p><img src="https://firebasestorage.googleapis.com/v0/b/israynotarray2.appspot.com/o/blog2%2Fnodejs%2Fnodemailer-google-email%2F2023-07-22%2012.48.40.png?alt=media&token=e3759b0c-d785-46d0-bae8-cecd37d8554d" alt="應用程式密碼"></p>
<p>點進去後，你選擇一下應用程式和裝置</p>
<ul>
<li>應用程式：選擇「郵件」</li>
<li>裝置：選擇「其他（自訂名稱）」</li>
</ul>
<p><img src="https://firebasestorage.googleapis.com/v0/b/israynotarray2.appspot.com/o/blog2%2Fnodejs%2Fnodemailer-google-email%2F2023-07-22%2012.49.34.png?alt=media&token=a46921fa-fb20-4fcf-8cd0-e64df8f5a333" alt="應用程式"></p>
<p>接著會跳出要你命名，你可以依照自己需求命名，所以你可以命名為「nodemailer-example」，然後點選「產生」</p>
<p><img src="https://firebasestorage.googleapis.com/v0/b/israynotarray2.appspot.com/o/blog2%2Fnodejs%2Fnodemailer-google-email%2F2023-07-22%2012.51.21.png?alt=media&token=dff32003-6253-43db-bea5-162561edbafc" alt="應用程式命名"></p>
<p>點下產生後，你就會取得一組 16 字元的密碼，請好好保存不要外流，這會是我們後續使用的密碼</p>
<p><img src="https://firebasestorage.googleapis.com/v0/b/israynotarray2.appspot.com/o/blog2%2Fnodejs%2Fnodemailer-google-email%2F202307221252.jpg?alt=media&token=ec0a3ca3-81e4-4dd9-945b-ced415f23b25" alt="系統產生的應用程式密碼"></p>
<blockquote>
<p><strong>Note</strong><br>Google 幾乎時常在更新這個介面，所以我往往文章會來不及更新，若又更新的話再麻煩告知我一聲，我會再更新文章內容。</p>
</blockquote>
<p>底下是 2023 年 10 月 20 日補上的畫面，如果你發現你找不到「應用程式密碼」的話也不用擔心，你可以在上方搜尋搜尋「應用程式密碼」</p>
<p><img src="https://firebasestorage.googleapis.com/v0/b/israynotarray2.appspot.com/o/blog2%2Fnodejs%2Fnodemailer-google-email%2F%E6%88%AA%E5%9C%96%202023-10-20%2014.05.41.png?alt=media&token=001676d6-cd2f-439b-a787-a95f52d9d5f7&_gl=1*1horus5*_ga*ODk0ODUxNTk2LjE2NDM0MjM0ODI.*_ga_CW55HF8NVT*MTY5Nzc4NDAxMi4xNDEuMS4xNjk3Nzg0MDY2LjYuMC4w" alt="應用程式密碼"></p>
<p>接著你就可以在下方 App Name 輸入「nodemail」，然後點選「建立」</p>
<p><img src="https://firebasestorage.googleapis.com/v0/b/israynotarray2.appspot.com/o/blog2%2Fnodejs%2Fnodemailer-google-email%2F%E6%88%AA%E5%9C%96%202023-10-20%2014.06.18.png?alt=media&token=6c252367-9d20-4c38-bb12-2ea9a91d215e&_gl=1*n7xw3w*_ga*ODk0ODUxNTk2LjE2NDM0MjM0ODI.*_ga_CW55HF8NVT*MTY5Nzc4NDAxMi4xNDEuMS4xNjk3Nzg0MTU0LjUzLjAuMA.." alt="App name"></p>
<p>建立後，你就會跳出一組類似亂碼的密碼，這就是我們要使用的密碼，請好好保存不要外流唷～</p>
<p><img src="https://firebasestorage.googleapis.com/v0/b/israynotarray2.appspot.com/o/blog2%2Fnodejs%2Fnodemailer-google-email%2F%E6%88%AA%E5%9C%96_2023-10-20_14_06_26.jpg?alt=media&token=93ae0591-1e80-45c3-b4db-1a8e537e5a7d&_gl=1*1qo8d57*_ga*ODk0ODUxNTk2LjE2NDM0MjM0ODI.*_ga_CW55HF8NVT*MTY5Nzc4NDAxMi4xNDEuMS4xNjk3Nzg0MjYyLjE5LjAuMA.." alt="應用程式密碼"></p>
<h3 id="撰寫程式碼"><a href="#撰寫程式碼" class="headerlink" title="撰寫程式碼"></a>撰寫程式碼</h3><p>接下來就是撰寫程式碼了，你只需要將你要用來發信的 Email 帳號跟剛剛生成的應用程式密碼填入到 Env</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GMAIL_USER=example@gmail.com # 不用擔心這是假的</span><br><span class="line">GMAIL_PASS=d81ydvsldqiwdhnc # 不用擔心這是假的</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>Note</strong><br>系統產生的應用程式密碼看起來會有空格，請去除不要複製空格；<code>GMAIL_USER</code> 就是你的 Gmail 帳號，而 <code>GMAIL_PASS</code> 就是你的應用程式密碼。</p>
</blockquote>
<p>接下來請你到 <code>routes</code> 資料夾的 <code>email.js</code>，貼入以下內容</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/server/send&#x27;</span>, <span class="keyword">async</span> (req, res, next)=&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> transporter = nodemailer.<span class="title function_">createTransport</span>(&#123;</span><br><span class="line">      <span class="attr">service</span>: <span class="string">&#x27;gmail&#x27;</span>,</span><br><span class="line">      <span class="attr">auth</span>: &#123;</span><br><span class="line">        <span class="attr">user</span>: process.<span class="property">env</span>.<span class="property">GMAIL_USER</span>,</span><br><span class="line">        <span class="attr">pass</span>: process.<span class="property">env</span>.<span class="property">GMAIL_PASS</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> transporter.<span class="title function_">verify</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> mailOptions = &#123;</span><br><span class="line">      <span class="attr">from</span>: process.<span class="property">env</span>.<span class="property">GMAIL_USER</span>,</span><br><span class="line">      <span class="attr">to</span>: <span class="string">&#x27;你要發送的對象信箱&#x27;</span>,</span><br><span class="line">      <span class="attr">subject</span>: <span class="string">&#x27;這是信件的主旨&#x27;</span>,</span><br><span class="line">      <span class="attr">text</span>: <span class="string">&#x27;這是信件的內容&#x27;</span>,</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    transporter.<span class="title function_">sendMail</span>(mailOptions, <span class="function">(<span class="params">err, info</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(err);</span><br><span class="line">        res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">send</span>(<span class="string">&#x27;Error sending email&#x27;</span>);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(info);</span><br><span class="line">        res.<span class="title function_">send</span>(<span class="string">&#x27;Email sent&#x27;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>恭喜你，到這邊為止你就可以正常發信了，而且不是透過 OAuth2 的方式，而是透過帳號密碼的方式，這樣就不會有上述的問題了~</p>
<h2 id="完整範例程式碼"><a href="#完整範例程式碼" class="headerlink" title="完整範例程式碼"></a>完整範例程式碼</h2><p>最後這邊我也附上完整的程式碼，你可以參考一下</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/hsiangfeng/node-nodemailer-finish">node-nodemailer-finish</a></li>
</ul>
<p>這一份程式碼你可以直接在畫面上點擊按鈕觸發發送信件的，當然，如果你要作為實戰使用還是需要做調整一下哩。</p>
<h2 id="結語"><a href="#結語" class="headerlink" title="結語"></a>結語</h2><p>不得不說這一塊真的是有點複雜且混亂，而且目前網路上的資源滿零散的，自己 Try 了不少次才弄出來，所以這邊我就整理一下，希望對你有幫助。</p>

    </div>

    
    
    

    <footer class="post-footer"><div style="color: var(--text-color);">
  <h4>
    <i class="fas fa-heart"></i>
    請我喝一杯咖啡
  </h4>
  <div style="color: var(--text-color); border: 5px var(--text-color) dashed;padding: 20px;font-size: 14px;">
    這篇筆記文章如果對你有幫助，
    <br />
    你可以也可以請我「喝一杯咖啡(Donate)」。
    <br /><br />
    <div style="display: flex;justify-content: center;align-items: center;">
      <a href="https://www.buymeacoffee.com/israynotarray" target="_blank" style="text-decoration: none !important;border: 0px !important;">
        <img src="https://cdn.buymeacoffee.com/buttons/v2/default-yellow.png" alt="Buy Me A Coffee" style="height: 60px !important;width: 217px !important;" >
      </a>
      ｜
      <a href="https://portaly.cc/israynotarray/support" target="_blank" style="text-decoration: none !important;border: 0px !important;">
        <img src="/images/logo.b91a6dbf.webp" alt="Buy Me A Coffee" style="height: 50px !important;background: #fff !important;border-radius: 5px !important;padding: 10px !important;" >
      </a>
    </div>
  </div>
</div>
<div style="color: var(--text-color); width: 100%;">
  <div>
    <h4>
      <i class="fab fa-google"></i>
      Google AD
    </h4>
  </div>
  <div
    style="height: 90px; width: 100%; border: 5px var(--text-color) dashed;">
    <div class="message-block">
      <p style="color: var(--text-color); font-size: 0.75rem;margin: 0;">
        撰寫一篇文章其實真的很花時間，如果你願意<strong>「關閉 Adblock (廣告阻擋器)」</strong>來支持我的話，我會非常感謝你 ヽ(・∀・)ﾉ
      </p>
    </div>
    <!-- hsiangfeng_post_end -->
    <ins
      class="adsbygoogle"
      style="display:block;height: 90px; width: 100%;"
      data-ad-client="ca-pub-4319471747130190"
      data-ad-slot="3804716479"
      data-ad-format="auto"
      data-full-width-responsive="true">
    </ins>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
  </div>
</div>

          <div class="post-tags">
              <a href="/tags/Nodejs/" rel="tag"># Nodejs</a>
              <a href="/tags/Nodemailer/" rel="tag"># Nodemailer</a>
              <a href="/tags/Gmail/" rel="tag"># Gmail</a>
              <a href="/tags/OAuth2/" rel="tag"># OAuth2</a>
              <a href="/tags/Email/" rel="tag"># Email</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/vue/20230711/2687889198/" rel="prev" title="關於在 Vue 的 Single-File Components 上使用 HOF 分析">
                  <i class="fa fa-angle-left"></i> 關於在 Vue 的 Single-File Components 上使用 HOF 分析
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/nuxt/20230808/2129825058/" rel="next" title="Nuxt3 使用 Nitro Proxy 解決跨域問題">
                  Nuxt3 使用 Nitro Proxy 解決跨域問題 <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments utterances-container"></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-user"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Ray - 轉載文章時請附上作者(Ray)及原文連結(Url)。</span>
  </div><div style="color: var(--text-color); width: 100%;">
  <div>
    <h4>
      <i class="fab fa-google"></i>
      Google AD
    </h4>
  </div>
  <div
    style="height: 90px; border: 5px var(--text-color) dashed;">
    <div class="message-block">
      <p style="color: var(--text-color);  font-size: 0.75rem;margin: 0;">
        撰寫一篇文章其實真的很花時間，如果你願意<strong>「關閉 Adblock (廣告阻擋器)」</strong>來支持我的話，我會非常感謝你 ヽ(・∀・)ﾉ
      </p>
    </div>
    <!-- hsiangfeng_bodyend -->
    <ins class="adsbygoogle"
        style="display:block"
        data-ad-client="ca-pub-4319471747130190"
        data-ad-slot="5395046960"
        data-ad-format="auto"
        data-full-width-responsive="true"></ins>
    <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
  </div>
  <script data-name="BMC-Widget" data-cfasync="false" src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js" data-id="israynotarray" data-description="Support me on Buy me a coffee!" data-message="" data-color="#5F7FFF" data-position="Right" data-x_margin="18" data-y_margin="18"></script>
</div>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="回到頂端">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

  <a href="https://github.com/hsiangfeng" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.24/fancybox/fancybox.umd.js" integrity="sha256-oyhjPiYRWGXaAt+ny/mTMWOnN1GBoZDUQnzzgC7FRI4=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/algoliasearch/4.20.0/algoliasearch-lite.umd.js" integrity="sha256-DABVk+hYj0mdUzo+7ViJC6cwLahQIejFvC+my2M/wfM=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/instantsearch.js/4.57.0/instantsearch.production.min.js" integrity="sha256-foJtB+Wd0wvvK+VU3KO0/H6CjwSwJfB1RnWlgx0Ov9U=" crossorigin="anonymous"></script><script src="/js/third-party/search/algolia-search.js"></script>




  <script src="/js/third-party/fancybox.js"></script>



  




<script class="next-config" data-name="utterances" type="application/json">{"enable":true,"repo":"hsiangfeng/hsiangfeng.github.io","issue_term":"pathname","theme":"github-dark"}</script>
<script src="/js/third-party/comments/utterances.js"></script>

</body>
</html>
